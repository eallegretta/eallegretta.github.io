window.paletools = window.paletools || {};
window.paletools['palesnipe-3.1.0'] = "KGZ1bmN0aW9uIChidXR0b25zKSB7DQogICAgY29uc3QgVkVSU0lPTiA9ICJ2My4xLjAiOw0KDQogICAgYnV0dG9ucyA9ICQuZXh0ZW5kKHsNCiAgICAgICAgYmFjazogJ0RpZ2l0MScsDQogICAgICAgIGVuYWJsZURpc2FibGU6ICdDb21tYScsDQogICAgICAgIGxpc3RzOiB7DQogICAgICAgICAgICB1cDogJ0Fycm93VXAnLA0KICAgICAgICAgICAgZG93bjogJ0Fycm93RG93bicsDQogICAgICAgICAgICBwcmV2OiAnQXJyb3dMZWZ0JywNCiAgICAgICAgICAgIG5leHQ6ICdBcnJvd1JpZ2h0JywNCiAgICAgICAgfSwNCiAgICAgICAgc2VhcmNoOiB7DQogICAgICAgICAgICByZXNldEJpZDogJ0JhY2txdW90ZScsDQogICAgICAgICAgICBkZWNNaW5CaWQ6ICdBcnJvd0xlZnQnLA0KICAgICAgICAgICAgaW5jTWluQmlkOiAnQXJyb3dSaWdodCcsDQogICAgICAgICAgICBkZWNNYXhCaWQ6ICdFbmQnLA0KICAgICAgICAgICAgaW5jTWF4QmlkOiAnSG9tZScsDQogICAgICAgICAgICBkZWNNaW5CdXk6ICdEZWxldGUnLA0KICAgICAgICAgICAgaW5jTWluQnV5OiAnUGFnZURvd24nLA0KICAgICAgICAgICAgZGVjTWF4QnV5OiAnQXJyb3dEb3duJywNCiAgICAgICAgICAgIGluY01heEJ1eTogJ0Fycm93VXAnLA0KICAgICAgICAgICAgc2VhcmNoOiAnRGlnaXQyJywNCiAgICAgICAgICAgIGJvdE1vZGVNaW5CaWQ6ICdCcmFja2V0UmlnaHQnLA0KICAgICAgICAgICAgYm90TW9kZU1pbkJ1eTogJ0JyYWNrZXRMZWZ0JywNCiAgICAgICAgICAgIGVuYWJsZUJvdE1vZGU6IGZhbHNlDQogICAgICAgIH0sDQogICAgICAgIHJlc3VsdHM6IHsNCiAgICAgICAgICAgIGJpZDogJ0RpZ2l0NCcsDQogICAgICAgICAgICBidXk6ICdEaWdpdDMnLA0KICAgICAgICAgICAgdHJhbnNmZXI6ICdLZXlSJywNCiAgICAgICAgICAgIGNsdWI6ICdLZXlDJywNCiAgICAgICAgICAgIHByZXNzRW50ZXI6IHRydWUsDQogICAgICAgICAgICBhdXRvQnV5OiBmYWxzZSwNCiAgICAgICAgICAgIHByZXZlbnRCYWNrOiBmYWxzZSwNCiAgICAgICAgICAgIHNlbGw6ICdLZXlRJywNCiAgICAgICAgICAgIGRlY0JpZDogJ0RlbGV0ZScsDQogICAgICAgICAgICBpbmNCaWQ6ICdQYWdlRG93bicNCiAgICAgICAgfQ0KICAgIH0sIGJ1dHRvbnMgfHwge30pOw0KICAgIGlmKHdpbmRvdy5fX3BhbGVzbmlwZUFjdGl2ZSkgcmV0dXJuOw0KICAgIHdpbmRvdy5fX3BhbGVzbmlwZUFjdGl2ZSA9IHRydWU7DQoNCg0KICAgIGxldCBfZW5hYmxlZCA9IHRydWU7DQogICAgbGV0IF9hcHBTdHlsZXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOw0KDQogICAgbGV0IF9wYWxlc25pcGVTZXR0aW5ncyA9IHsNCiAgICAgICAgYXBwVmVyc2lvbjogVkVSU0lPTiwNCiAgICAgICAgZ3JpZE1vZGU6IGZhbHNlLA0KICAgICAgICBidXR0b25zOiBidXR0b25zDQogICAgfTsNCg0KICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgicGFsZXNuaXBlOnNldHRpbmdzIikpIHsNCiAgICAgICAgX3BhbGVzbmlwZVNldHRpbmdzID0gSlNPTi5wYXJzZShhdG9iKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJwYWxlc25pcGU6c2V0dGluZ3MiKSkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNvcHlUb0NsaXBib2FyZChzdHIpIHsNCiAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOw0KICAgICAgICBlbC52YWx1ZSA9IHN0cjsNCiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdyZWFkb25seScsICcnKTsNCiAgICAgICAgZWwuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOw0KICAgICAgICBlbC5zdHlsZS5sZWZ0ID0gJy05OTk5cHgnOw0KICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTsNCiAgICAgICAgZWwuc2VsZWN0KCk7DQogICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7DQogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWwpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNhdmVDb25maWd1cmF0aW9uKCkgew0KICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgicGFsZXNuaXBlOnNldHRpbmdzIiwgYnRvYShKU09OLnN0cmluZ2lmeShfcGFsZXNuaXBlU2V0dGluZ3MpKSk7DQogICAgICAgIHJlc2V0Q3NzKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0T2JqZWN0UHJvcGVydHlCeVBhdGgob2JqLCBwYXRoLCB2YWx1ZSkgew0KICAgICAgICB2YXIgc2NoZW1hID0gb2JqOw0KICAgICAgICB2YXIgcExpc3QgPSBwYXRoLnNwbGl0KCcuJyk7DQogICAgICAgIHZhciBsZW4gPSBwTGlzdC5sZW5ndGg7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuIC0gMTsgaSsrKSB7DQogICAgICAgICAgICB2YXIgZWxlbSA9IHBMaXN0W2ldOw0KICAgICAgICAgICAgaWYgKCFzY2hlbWFbZWxlbV0pIHNjaGVtYVtlbGVtXSA9IHt9DQogICAgICAgICAgICBzY2hlbWEgPSBzY2hlbWFbZWxlbV07DQogICAgICAgIH0NCg0KICAgICAgICBzY2hlbWFbcExpc3RbbGVuIC0gMV1dID0gdmFsdWU7DQogICAgfQ0KDQogICAgLy8gcmVzZXQgY29uc29sZQ0KICAgIGxldCBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsNCiAgICBpZnJhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7DQogICAgd2luZG93LmNvbnNvbGUgPSBpZnJhbWUuY29udGVudFdpbmRvdy5jb25zb2xlOw0KDQogICAgd2luZG93Lk1BWF9ORVdfSVRFTVMgPSBOdW1iZXIuTUFYX1ZBTFVFOw0KDQogICAgY29uc3QgZ2V0Q3VycmVudENvbnRyb2xsZXIgPSAoKSA9PiBnZXRBcHBNYWluKCkuZ2V0Um9vdFZpZXdDb250cm9sbGVyKCkuZ2V0UHJlc2VudGVkVmlld0NvbnRyb2xsZXIoKS5nZXRDdXJyZW50Vmlld0NvbnRyb2xsZXIoKS5nZXRDdXJyZW50Q29udHJvbGxlcigpOw0KDQogICAgLy8kKCIudXQtZmlmYS1oZWFkZXItdmlldyIpLmFwcGVuZChgPGJ1dHRvbiBpZD0idGhyb3ciPkRFQlVHPC9idXR0b24+YCk7DQoNCiAgICAkKCIjdGhyb3ciKS5jbGljayhmdW5jdGlvbiAoKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiZGVidWcgZXJyb3IiKTsNCiAgICB9KTsNCg0KICAgIGNvbnN0IFVUTGFiZWxDb250cm9sID0gZnVuY3Rpb24gKHQpIHsNCiAgICAgICAgVVRDb250cm9sLmNhbGwodGhpcyk7DQogICAgfQ0KDQogICAgVVRMYWJlbENvbnRyb2wucHJvdG90eXBlLl9nZW5lcmF0ZSA9IGZ1bmN0aW9uIF9nZW5lcmF0ZSgpIHsNCiAgICAgICAgaWYgKCF0aGlzLmdlbmVyYXRlZCkgew0KICAgICAgICAgICAgdGhpcy5fbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOw0KICAgICAgICAgICAgdGhpcy5fX3Jvb3QgPSB0aGlzLl9sYWJlbDsNCiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFVUTGFiZWxDb250cm9sLnByb3RvdHlwZS5zZXRUZXh0ID0gZnVuY3Rpb24gKHRleHQpIHsNCiAgICAgICAgdGhpcy5fbGFiZWwudGV4dENvbnRlbnQgPSB0ZXh0Ow0KICAgIH0NCg0KICAgIFVUTGFiZWxDb250cm9sLnByb3RvdHlwZS5kZXN0cm95R2VuZXJhdGVkRWxlbWVudHMgPSBmdW5jdGlvbiBkZXN0cm95R2VuZXJhdGVkRWxlbWVudHMoKSB7DQogICAgICAgICQodGhpcy5fX3Jvb3QpLnJlbW92ZSgpOw0KICAgICAgICB0aGlzLl9fcm9vdCA9IG51bGw7DQogICAgfQ0KDQogICAgVVRMYWJlbENvbnRyb2wucHJvdG90eXBlLmdldFJvb3RFbGVtZW50ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fX3Jvb3Q7DQogICAgfQ0KDQogICAgY29uc3QgVVRMYWJlbFdpdGhUZXh0SW5wdXRDb250cm9sID0gZnVuY3Rpb24gKHQpIHsNCiAgICAgICAgVVRDb250cm9sLmNhbGwodGhpcyk7DQogICAgfQ0KDQogICAgVVRMYWJlbFdpdGhUZXh0SW5wdXRDb250cm9sLnByb3RvdHlwZS5fZ2VuZXJhdGUgPSBmdW5jdGlvbiBfZ2VuZXJhdGUoKSB7DQogICAgICAgIGlmICghdGhpcy5nZW5lcmF0ZWQpIHsNCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KDQogICAgICAgICAgICB0aGlzLl9sYWJlbCA9IG5ldyBVVExhYmVsQ29udHJvbCgpOw0KICAgICAgICAgICAgdGhpcy5faW5wdXQgPSBuZXcgVVRUZXh0SW5wdXRDb250cm9sKCk7DQoNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9sYWJlbC5nZXRSb290RWxlbWVudCgpKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9pbnB1dC5nZXRSb290RWxlbWVudCgpKTsNCg0KICAgICAgICAgICAgdGhpcy5fb25JbnB1dENoYW5nZUNhbGxiYWNrcyA9IFtdOw0KDQogICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7DQoNCiAgICAgICAgICAgICQodGhpcy5faW5wdXQuZ2V0Um9vdEVsZW1lbnQoKSkua2V5ZG93bihmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBjYWxsYmFjayBvZiBzZWxmLl9vbklucHV0Q2hhbmdlQ2FsbGJhY2tzKSB7DQogICAgICAgICAgICAgICAgICAgIChjYWxsYmFjaykodGhpcywgZS5vcmlnaW5hbEV2ZW50LmNvZGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgdGhpcy5fX3Jvb3QgPSBjb250YWluZXI7DQogICAgICAgICAgICB0aGlzLmdlbmVyYXRlZCA9IHRydWU7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBVVExhYmVsV2l0aFRleHRJbnB1dENvbnRyb2wucHJvdG90eXBlLnNldExhYmVsID0gZnVuY3Rpb24gKHRleHQpIHsNCiAgICAgICAgdGhpcy5fbGFiZWwuc2V0VGV4dCh0ZXh0KTsNCiAgICB9DQoNCiAgICBVVExhYmVsV2l0aFRleHRJbnB1dENvbnRyb2wucHJvdG90eXBlLnNldElucHV0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5faW5wdXQuZ2V0Um9vdEVsZW1lbnQoKS5pZCA9IHZhbHVlOw0KICAgIH0NCg0KICAgIFVUTGFiZWxXaXRoVGV4dElucHV0Q29udHJvbC5wcm90b3R5cGUuc2V0SW5wdXRWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgICB0aGlzLl9pbnB1dC5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgfQ0KDQogICAgVVRMYWJlbFdpdGhUZXh0SW5wdXRDb250cm9sLnByb3RvdHlwZS5vbklucHV0Q2hhbmdlID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7DQogICAgICAgIHRoaXMuX29uSW5wdXRDaGFuZ2VDYWxsYmFja3MucHVzaChjYWxsYmFjayk7DQogICAgfQ0KDQogICAgVVRMYWJlbFdpdGhUZXh0SW5wdXRDb250cm9sLnByb3RvdHlwZS5kZXN0cm95R2VuZXJhdGVkRWxlbWVudHMgPSBmdW5jdGlvbiBkZXN0cm95R2VuZXJhdGVkRWxlbWVudHMoKSB7DQogICAgICAgICQodGhpcy5fX3Jvb3QpLnJlbW92ZSgpOw0KICAgICAgICB0aGlzLl9fcm9vdCA9IG51bGw7DQogICAgfQ0KDQogICAgVVRMYWJlbFdpdGhUZXh0SW5wdXRDb250cm9sLnByb3RvdHlwZS5nZXRSb290RWxlbWVudCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX19yb290Ow0KICAgIH0NCg0KICAgIGNvbnN0IFVUTGFiZWxXaXRoVG9nZ2xlQ29udHJvbCA9IGZ1bmN0aW9uICh0KSB7DQogICAgICAgIFVUQ29udHJvbC5jYWxsKHRoaXMpOw0KICAgIH0NCg0KICAgIFVUTGFiZWxXaXRoVG9nZ2xlQ29udHJvbC5wcm90b3R5cGUuX2dlbmVyYXRlID0gZnVuY3Rpb24gX2dlbmVyYXRlKCkgew0KICAgICAgICBpZiAoIXRoaXMuZ2VuZXJhdGVkKSB7DQogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCg0KICAgICAgICAgICAgdGhpcy5fbGFiZWwgPSBuZXcgVVRMYWJlbENvbnRyb2woKTsNCiAgICAgICAgICAgIHRoaXMuX3RvZ2dsZSA9IG5ldyBVVFRvZ2dsZUNvbnRyb2woKTsNCg0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuX2xhYmVsLmdldFJvb3RFbGVtZW50KCkpOw0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuX3RvZ2dsZS5nZXRSb290RWxlbWVudCgpKTsNCg0KICAgICAgICAgICAgdGhpcy5fdG9nZ2xlLmluaXQoKTsNCiAgICAgICAgICAgIHRoaXMuX3RvZ2dsZS5hZGRUYXJnZXQodGhpcywgdGhpcy5fb25Ub2dnbGVkLCBFdmVudFR5cGUuVEFQKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgICAgICB0aGlzLl9fcm9vdCA9IGNvbnRhaW5lcjsNCiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFVUTGFiZWxXaXRoVG9nZ2xlQ29udHJvbC5wcm90b3R5cGUuc2V0TGFiZWwgPSBmdW5jdGlvbiAodGV4dCkgew0KICAgICAgICB0aGlzLl9sYWJlbC5zZXRUZXh0KHRleHQpOw0KICAgIH0NCg0KICAgIFVUTGFiZWxXaXRoVG9nZ2xlQ29udHJvbC5wcm90b3R5cGUuc2V0VG9nZ2xlSWQgPSBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5fdG9nZ2xlLmdldFJvb3RFbGVtZW50KCkuaWQgPSB2YWx1ZTsNCiAgICB9DQoNCiAgICBVVExhYmVsV2l0aFRvZ2dsZUNvbnRyb2wucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5fdG9nZ2xlLnRvZ2dsZSgpOw0KICAgIH0NCg0KICAgIFVUTGFiZWxXaXRoVG9nZ2xlQ29udHJvbC5wcm90b3R5cGUuZGVzdHJveUdlbmVyYXRlZEVsZW1lbnRzID0gZnVuY3Rpb24gZGVzdHJveUdlbmVyYXRlZEVsZW1lbnRzKCkgew0KICAgICAgICAkKHRoaXMuX19yb290KS5yZW1vdmUoKTsNCiAgICAgICAgdGhpcy5fX3Jvb3QgPSBudWxsOw0KICAgIH0NCg0KICAgIFVUTGFiZWxXaXRoVG9nZ2xlQ29udHJvbC5wcm90b3R5cGUuX29uVG9nZ2xlZCA9IGZ1bmN0aW9uKGVsZW0sIGV2ZW50VHlwZSwgdmFsdWUpew0KICAgICAgICBpZih0aGlzLm9uVG9nZ2xlKXsNCiAgICAgICAgICAgICh0aGlzLm9uVG9nZ2xlKShlbGVtLCBldmVudFR5cGUsIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFVUTGFiZWxXaXRoVG9nZ2xlQ29udHJvbC5wcm90b3R5cGUuZ2V0Um9vdEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9fcm9vdDsNCiAgICB9DQoNCiAgICBjb25zdCBQYWxlc25pcGVTZXR0aW5nc1ZpZXcgPSBmdW5jdGlvbiAodCkgew0KICAgICAgICBVVFZpZXcuY2FsbCh0aGlzKTsNCiAgICB9DQoNCiAgICBKU1V0aWxzLmluaGVyaXRzKFBhbGVzbmlwZVNldHRpbmdzVmlldywgVVRWaWV3KTsNCg0KICAgIFBhbGVzbmlwZVNldHRpbmdzVmlldy5wcm90b3R5cGUuX2dlbmVyYXRlID0gZnVuY3Rpb24gX2dlbmVyYXRlKCkgew0KICAgICAgICBsZXQgc2VsZiA9IHRoaXM7DQogICAgICAgIGZ1bmN0aW9uIGFkZExhYmVsV2l0aElucHV0KGNvbnRhaW5lciwgbGFiZWwsIGlucHV0SWQpIHsNCiAgICAgICAgICAgIGNvbnN0IGxhYmVsV2l0aElucHV0ID0gbmV3IFVUTGFiZWxXaXRoVGV4dElucHV0Q29udHJvbCgpOw0KICAgICAgICAgICAgbGFiZWxXaXRoSW5wdXQuc2V0TGFiZWwobGFiZWwpOw0KICAgICAgICAgICAgbGFiZWxXaXRoSW5wdXQuc2V0SW5wdXRJZChgcGFsZXNuaXBlLWJ1dHRvbnMtJHtpbnB1dElkLnJlcGxhY2UoL1wuL2csICItIil9YCk7DQoNCiAgICAgICAgICAgIGxldCBidXR0b25WYWx1ZSA9IF9wYWxlc25pcGVTZXR0aW5ncy5idXR0b25zOw0KICAgICAgICAgICAgZm9yIChsZXQgbGV2ZWwgb2YgaW5wdXRJZC5zcGxpdCgnLicpKSB7DQogICAgICAgICAgICAgICAgYnV0dG9uVmFsdWUgPSBidXR0b25WYWx1ZVtsZXZlbF07DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxhYmVsV2l0aElucHV0LnNldElucHV0VmFsdWUoYnV0dG9uVmFsdWUpOw0KICAgICAgICAgICAgbGFiZWxXaXRoSW5wdXQub25JbnB1dENoYW5nZShzZWxmLmhhbmRsZUlucHV0Q2hhbmdlKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbFdpdGhJbnB1dC5nZXRSb290RWxlbWVudCgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGFkZExhYmVsV2l0aFRvZ2dsZShjb250YWluZXIsIGxhYmVsLCB0b2dnbGVJZCl7DQogICAgICAgICAgICBjb25zdCBsYWJlbFdpdGhUb2dnbGUgPSBuZXcgVVRMYWJlbFdpdGhUb2dnbGVDb250cm9sKCk7DQogICAgICAgICAgICBsYWJlbFdpdGhUb2dnbGUuc2V0TGFiZWwobGFiZWwpOw0KICAgICAgICAgICAgbGFiZWxXaXRoVG9nZ2xlLnNldFRvZ2dsZUlkKGBwYWxlc25pcGUtYnV0dG9ucy0ke3RvZ2dsZUlkLnJlcGxhY2UoL1wuL2csICItIil9YCk7DQoNCiAgICAgICAgICAgIGxldCBidXR0b25WYWx1ZSA9IF9wYWxlc25pcGVTZXR0aW5ncy5idXR0b25zOw0KICAgICAgICAgICAgZm9yIChsZXQgbGV2ZWwgb2YgdG9nZ2xlSWQuc3BsaXQoJy4nKSkgew0KICAgICAgICAgICAgICAgIGJ1dHRvblZhbHVlID0gYnV0dG9uVmFsdWVbbGV2ZWxdOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihidXR0b25WYWx1ZSl7DQogICAgICAgICAgICAgICAgbGFiZWxXaXRoVG9nZ2xlLnRvZ2dsZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsYWJlbFdpdGhUb2dnbGUub25Ub2dnbGUgPSBzZWxmLmhhbmRsZVRvZ2dsZUNoYW5nZTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbFdpdGhUb2dnbGUuZ2V0Um9vdEVsZW1lbnQoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXRoaXMuZ2VuZXJhdGVkKSB7DQogICAgICAgICAgICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgidXQtbWFya2V0LXNlYXJjaC1maWx0ZXJzLXZpZXciKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJmbG9hdGluZyIpOw0KICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlWyJvdmVyZmxvdy15Il0gPSAic2Nyb2xsIjsNCiAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZVsiZGlzcGxheSJdID0gImZsZXgiOw0KICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlWyJhbGlnbi1pdGVtcyJdID0gImNlbnRlciI7DQoNCiAgICAgICAgICAgIGxldCBjb250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBjb250ZW50Q29udGFpbmVyLnN0eWxlWyJoZWlnaHQiXSA9ICIxMDAlIjsNCiAgICAgICAgICAgIGNvbnRlbnRDb250YWluZXIuY2xhc3NMaXN0LmFkZCgidXQtcGlubmVkLWxpc3QtY29udGFpbmVyIik7DQogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGVudENvbnRhaW5lcik7DQogICAgICAgICAgICBsZXQgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgY29udGVudC5jbGFzc0xpc3QuYWRkKCJwYWxlc25pcGUtc2V0dGluZ3Mtd3JhcHBlciIpOw0KICAgICAgICAgICAgY29udGVudC5jbGFzc0xpc3QuYWRkKCJ1dC1waW5uZWQtbGlzdCIpOw0KICAgICAgICAgICAgY29udGVudENvbnRhaW5lci5hcHBlbmRDaGlsZChjb250ZW50KTsNCg0KICAgICAgICAgICAgbGV0IGdlbmVyYWxDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KGdlbmVyYWxDb250YWluZXIsICJFbmFibGUgLyBEaXNhYmxlIFBhbGVzbmlwZSIsICJlbmFibGVEaXNhYmxlIik7DQogICAgICAgICAgICBhZGRMYWJlbFdpdGhUb2dnbGUoZ2VuZXJhbENvbnRhaW5lciwgIkF1dG8gcHJlc3MgRU5URVIgYWZ0ZXIgYnV5IiwgInJlc3VsdHMucHJlc3NFbnRlciIpOw0KICAgICAgICAgICAgYWRkTGFiZWxXaXRoVG9nZ2xlKGdlbmVyYWxDb250YWluZXIsICJCT1QgTW9kZSIsICJzZWFyY2guZW5hYmxlQm90TW9kZSIpOw0KDQogICAgICAgICAgICBsZXQgc2VhcmNoQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBhZGRMYWJlbFdpdGhJbnB1dChzZWFyY2hDb250YWluZXIsICJHbyBiYWNrIiwgImJhY2siKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KHNlYXJjaENvbnRhaW5lciwgIlNlYXJjaCIsICJzZWFyY2guc2VhcmNoIik7DQogICAgICAgICAgICBhZGRMYWJlbFdpdGhJbnB1dChzZWFyY2hDb250YWluZXIsICJCdXkgbm93IiwgInJlc3VsdHMuYnV5Iik7DQogICAgICAgICAgICBhZGRMYWJlbFdpdGhJbnB1dChzZWFyY2hDb250YWluZXIsICJSZXNldCBiaWQiLCAic2VhcmNoLnJlc2V0QmlkIik7DQogICAgICAgICAgICBhZGRMYWJlbFdpdGhJbnB1dChzZWFyY2hDb250YWluZXIsICJCaWQiLCAicmVzdWx0cy5iaWQiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KHNlYXJjaENvbnRhaW5lciwgIlNlbmQgaXRlbSB0byB0cmFuc2ZlciBsaXN0IiwgInJlc3VsdHMudHJhbnNmZXIiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KHNlYXJjaENvbnRhaW5lciwgIlNlbmQgaXRlbSB0byBjbHViIiwgInJlc3VsdHMuY2x1YiIpOw0KICAgICAgICAgICAgYWRkTGFiZWxXaXRoSW5wdXQoc2VhcmNoQ29udGFpbmVyLCAiUXVpY2sgc2VsbCBpdGVtIiwgInJlc3VsdHMuc2VsbCIpOw0KICAgICAgICAgICAgYWRkTGFiZWxXaXRoSW5wdXQoc2VhcmNoQ29udGFpbmVyLCAiU2VsZWN0IHByZXZpb3VzIHBsYXllciBpbiBsaXN0cyIsICJsaXN0cy51cCIpOw0KICAgICAgICAgICAgYWRkTGFiZWxXaXRoSW5wdXQoc2VhcmNoQ29udGFpbmVyLCAiU2VsZWN0IG5leHQgcGxheWVyIGluIGxpc3RzIiwgImxpc3RzLmRvd24iKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KHNlYXJjaENvbnRhaW5lciwgIkdvIHRvIHByZXZpb3VzIHBhZ2UiLCAibGlzdHMucHJldiIpOw0KICAgICAgICAgICAgYWRkTGFiZWxXaXRoSW5wdXQoc2VhcmNoQ29udGFpbmVyLCAiR28gdG8gbmV4dCBwYWdlIiwgImxpc3RzLm5leHQiKTsNCiAgICAgICAgICAgIC8vIGFkZCBhdXRvcHJlc3MgZW50ZXIgc2V0dGluZw0KDQogICAgICAgICAgICBsZXQgYmlkQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBhZGRMYWJlbFdpdGhJbnB1dChiaWRDb250YWluZXIsICJEZWNyZWFzZSBtaW4gYmlkIHZhbHVlIiwgInNlYXJjaC5kZWNNaW5CaWQiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KGJpZENvbnRhaW5lciwgIkluY3JlYXNlIG1pbiBiaWQgdmFsdWUiLCAic2VhcmNoLmluY01pbkJpZCIpOw0KICAgICAgICAgICAgYWRkTGFiZWxXaXRoSW5wdXQoYmlkQ29udGFpbmVyLCAiRGVjcmVhc2UgbWF4IGJpZCB2YWx1ZSIsICJzZWFyY2guZGVjTWF4QmlkIik7DQogICAgICAgICAgICBhZGRMYWJlbFdpdGhJbnB1dChiaWRDb250YWluZXIsICJJbmNyZWFzZSBtYXggYmlkIHZhbHVlIiwgInNlYXJjaC5pbmNNYXhCaWQiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KGJpZENvbnRhaW5lciwgIkRlY3JlYXNlIG1pbiBidXkgbm93IHZhbHVlIiwgInNlYXJjaC5kZWNNaW5CdXkiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KGJpZENvbnRhaW5lciwgIkluY3JlYXNlIG1pbiBidXkgbm93IHZhbHVlIiwgInNlYXJjaC5pbmNNaW5CdXkiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KGJpZENvbnRhaW5lciwgIkRlY3JlYXNlIG1heCBidXkgbm93IHZhbHVlIiwgInNlYXJjaC5kZWNNYXhCdXkiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KGJpZENvbnRhaW5lciwgIkluY3JlYXNlIG1heCBidXkgbm93IHZhbHVlIiwgInNlYXJjaC5pbmNNYXhCdXkiKTsNCiAgICAgICAgICAgIGFkZExhYmVsV2l0aElucHV0KGJpZENvbnRhaW5lciwgIkJvdCBtb2RlLCBpbmNyZW1lbnQgbWluIGJpZCIsICJzZWFyY2guYm90TW9kZU1pbkJpZCIpOw0KICAgICAgICAgICAgYWRkTGFiZWxXaXRoSW5wdXQoYmlkQ29udGFpbmVyLCAiQm90IG1vZGUsIGluY3JlbWVudCBtaW4gYnV5IG5vdyIsICJzZWFyY2guYm90TW9kZU1pbkJ1eSIpOw0KDQogICAgICAgICAgICAvLyBhZGQgdG9nZ2xlIGJvdCBtb2RlDQoNCiAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoZ2VuZXJhbENvbnRhaW5lcik7DQogICAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKHNlYXJjaENvbnRhaW5lcik7DQogICAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKGJpZENvbnRhaW5lcik7DQoNCiAgICAgICAgICAgIHRoaXMuX19yb290ID0gY29udGFpbmVyOw0KICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZWQgPSB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgUGFsZXNuaXBlU2V0dGluZ3NWaWV3LnByb3RvdHlwZS5oYW5kbGVJbnB1dENoYW5nZSA9IGZ1bmN0aW9uIChlbGVtLCBjb2RlKSB7DQogICAgICAgIGxldCBwYXRoID0gZWxlbS5pZC5yZXBsYWNlKCJwYWxlc25pcGUtYnV0dG9ucy0iLCAiIikucmVwbGFjZSgvLS9nLCAiLiIpOw0KICAgICAgICBzZXRPYmplY3RQcm9wZXJ0eUJ5UGF0aChfcGFsZXNuaXBlU2V0dGluZ3MuYnV0dG9ucywgcGF0aCwgY29kZSk7DQogICAgICAgIGVsZW0udmFsdWUgPSBjb2RlOw0KICAgICAgICBzYXZlQ29uZmlndXJhdGlvbigpOw0KICAgIH0NCg0KICAgIFBhbGVzbmlwZVNldHRpbmdzVmlldy5wcm90b3R5cGUuaGFuZGxlVG9nZ2xlQ2hhbmdlID0gZnVuY3Rpb24gKGVsZW0sIGV2ZW50VHlwZSwgdmFsdWUpIHsNCiAgICAgICAgbGV0IHBhdGggPSBlbGVtLmdldFJvb3RFbGVtZW50KCkuaWQucmVwbGFjZSgicGFsZXNuaXBlLWJ1dHRvbnMtIiwgIiIpLnJlcGxhY2UoLy0vZywgIi4iKTsNCiAgICAgICAgc2V0T2JqZWN0UHJvcGVydHlCeVBhdGgoX3BhbGVzbmlwZVNldHRpbmdzLmJ1dHRvbnMsIHBhdGgsIHZhbHVlLnRvZ2dsZVN0YXRlKTsNCiAgICAgICAgc2F2ZUNvbmZpZ3VyYXRpb24oKTsNCiAgICB9DQoNCiAgICBjb25zdCBQYWxlc25pcGVTZXR0aW5nc0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAodCkgew0KICAgICAgICBVVFZpZXdDb250cm9sbGVyLmNhbGwodGhpcyk7DQogICAgfTsNCg0KICAgIEpTVXRpbHMuaW5oZXJpdHMoUGFsZXNuaXBlU2V0dGluZ3NDb250cm9sbGVyLCBVVFZpZXdDb250cm9sbGVyKTsNCg0KICAgIFBhbGVzbmlwZVNldHRpbmdzQ29udHJvbGxlci5wcm90b3R5cGUuX2dldFZpZXdJbnN0YW5jZUZyb21EYXRhID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gbmV3IFBhbGVzbmlwZVNldHRpbmdzVmlldygpOw0KICAgIH0NCg0KICAgIFBhbGVzbmlwZVNldHRpbmdzQ29udHJvbGxlci5wcm90b3R5cGUudmlld0RpZEFwcGVhciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5nZXROYXZpZ2F0aW9uQ29udHJvbGxlcigpLnNldE5hdmlnYXRpb25WaXNpYmlsaXR5KHRydWUsIHRydWUpOw0KICAgIH0NCg0KICAgIFBhbGVzbmlwZVNldHRpbmdzQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0TmF2aWdhdGlvblRpdGxlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gIlBhbGVzbmlwZSBTZXR0aW5ncyI7DQogICAgfQ0KDQoNCiAgICBjb25zdCBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3X19nZW5lcmF0ZSA9IFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLl9nZW5lcmF0ZQ0KICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLl9nZW5lcmF0ZSA9IGZ1bmN0aW9uIF9nZW5lcmF0ZSgpIHsNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ29udGFpbmVyKGNoaWxkKSB7DQogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJpbmxpbmUtbGlzdC1zZWxlY3QiKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJ1dC1wbGF5ZXItc2VhcmNoLWNvbnRyb2wiKTsNCiAgICAgICAgICAgIGNvbnN0IGlubGluZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpDQogICAgICAgICAgICBpbmxpbmVDb250YWluZXIuY2xhc3NMaXN0LmFkZCgiaW5saW5lLWNvbnRhaW5lciIpOw0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGlubGluZUNvbnRhaW5lcik7DQogICAgICAgICAgICBjb25zdCBpbmxpbmVJbmxpbmVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgIGlubGluZUNvbnRhaW5lci5hcHBlbmRDaGlsZChpbmxpbmVJbmxpbmVDb250YWluZXIpOw0KICAgICAgICAgICAgaW5saW5lSW5saW5lQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoInV0LXBsYXllci1zZWFyY2gtY29udHJvbC0taW5wdXQtY29udGFpbmVyIik7DQogICAgICAgICAgICBpbmxpbmVJbmxpbmVDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hpbGQpOw0KICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjsNCiAgICAgICAgfQ0KDQogICAgICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdfX2dlbmVyYXRlLmNhbGwodGhpcyk7DQogICAgICAgIGlmICghdGhpcy5fZ2VuZXJhdGVQYWxlc25pcGVDYWxsZWQpIHsNCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoInV0LWl0ZW0tc2VhcmNoLXZpZXciKTsNCiAgICAgICAgICAgIHRoaXMuX3BsYXllcklkID0gbmV3IFVUVGV4dElucHV0Q29udHJvbCgpOw0KICAgICAgICAgICAgY29uc3QgcGxheWVySWRDb250YWluZXIgPSBjcmVhdGVDb250YWluZXIodGhpcy5fcGxheWVySWQuZ2V0Um9vdEVsZW1lbnQoKSk7DQoNCiAgICAgICAgICAgIHRoaXMuX3BsYXllclJhdGluZyA9IG5ldyBVVFRleHRJbnB1dENvbnRyb2woKTsNCiAgICAgICAgICAgIGNvbnN0IHBsYXllclJhdGluZ0NvbnRhaW5lciA9IGNyZWF0ZUNvbnRhaW5lcih0aGlzLl9wbGF5ZXJSYXRpbmcuZ2V0Um9vdEVsZW1lbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBmaWx0ZXJzQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBmaWx0ZXJzQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoInNhdmVkLWZpbHRlcnMiKTsNCg0KICAgICAgICAgICAgdGhpcy5fZmlsdGVyTmFtZSA9IG5ldyBVVFRleHRJbnB1dENvbnRyb2woKTsNCiAgICAgICAgICAgIHRoaXMuX2ZpbHRlck5hbWUuaW5pdCgpOw0KICAgICAgICAgICAgdGhpcy5fZmlsdGVyTmFtZS5zZXRQbGFjZWhvbGRlcigiRmlsdGVyIG5hbWUiKTsNCg0KICAgICAgICAgICAgdGhpcy5fc2F2ZUZpbHRlckJ1dHRvbiA9IG5ldyBVVFN0YW5kYXJkQnV0dG9uQ29udHJvbCgpOw0KICAgICAgICAgICAgdGhpcy5fc2F2ZUZpbHRlckJ1dHRvbi5pbml0KCk7DQogICAgICAgICAgICB0aGlzLl9zYXZlRmlsdGVyQnV0dG9uLnNldFRleHQoIlNhdmUiKTsNCiAgICAgICAgICAgIHRoaXMuX3NhdmVGaWx0ZXJCdXR0b24uYWRkVGFyZ2V0KHRoaXMsIHRoaXMuc2F2ZUZpbHRlciwgRXZlbnRUeXBlLlRBUCk7DQoNCiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbHRlckJ1dHRvbiA9IG5ldyBVVFN0YW5kYXJkQnV0dG9uQ29udHJvbCgpOw0KICAgICAgICAgICAgdGhpcy5fZGVsZXRlRmlsdGVyQnV0dG9uLmluaXQoKTsNCiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbHRlckJ1dHRvbi5zZXRUZXh0KCJEZWxldGUiKTsNCiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbHRlckJ1dHRvbi5hZGRUYXJnZXQodGhpcywgdGhpcy5kZWxldGVGaWx0ZXIsIEV2ZW50VHlwZS5UQVApOw0KDQogICAgICAgICAgICB0aGlzLl9zYXZlZEZpbHRlcnMgPSBuZXcgVVREcm9wRG93bkNvbnRyb2woKTsNCiAgICAgICAgICAgIHRoaXMuX3NhdmVkRmlsdGVycy5pbml0KCk7DQogICAgICAgICAgICB0aGlzLl9zYXZlZEZpbHRlcnMuYWRkVGFyZ2V0KHRoaXMsIHRoaXMub25TYXZlZEZpbHRlcnNDaGFuZ2UsIEV2ZW50VHlwZS5DSEFOR0UpOw0KDQogICAgICAgICAgICAkKGZpbHRlcnNDb250YWluZXIpDQogICAgICAgICAgICAgICAgLmFwcGVuZCh0aGlzLl9maWx0ZXJOYW1lLmdldFJvb3RFbGVtZW50KCkpDQogICAgICAgICAgICAgICAgLmFwcGVuZCh0aGlzLl9zYXZlRmlsdGVyQnV0dG9uLmdldFJvb3RFbGVtZW50KCkpDQogICAgICAgICAgICAgICAgLmFwcGVuZCh0aGlzLl9kZWxldGVGaWx0ZXJCdXR0b24uZ2V0Um9vdEVsZW1lbnQoKSkNCiAgICAgICAgICAgICAgICAuYXBwZW5kKHRoaXMuX3NhdmVkRmlsdGVycy5nZXRSb290RWxlbWVudCgpKTsNCg0KDQogICAgICAgICAgICAkKGNvbnRhaW5lcikNCiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoInBhbGVzbmlwZS1lbGVtZW50IikNCiAgICAgICAgICAgICAgICAuYXBwZW5kKGZpbHRlcnNDb250YWluZXIpDQogICAgICAgICAgICAgICAgLmFwcGVuZChwbGF5ZXJJZENvbnRhaW5lcikNCiAgICAgICAgICAgICAgICAuYXBwZW5kKHBsYXllclJhdGluZ0NvbnRhaW5lcik7DQogICAgICAgICAgICAkKGNvbnRhaW5lcikuaW5zZXJ0QmVmb3JlKCQoIi51dC1pdGVtLXNlYXJjaC12aWV3IiwgdGhpcy5fX3Jvb3QpKTsNCg0KICAgICAgICAgICAgdGhpcy5fcGxheWVySWQuaW5pdCgpOw0KICAgICAgICAgICAgdGhpcy5fcGxheWVySWQuc2V0UGxhY2Vob2xkZXIoIlBsYXllciBJRCIpOw0KICAgICAgICAgICAgdGhpcy5fcGxheWVySWQuc2V0TWF4TGVuZ3RoKDI1KTsNCiAgICAgICAgICAgIHRoaXMuX3BsYXllcklkLmFkZFRhcmdldCh0aGlzLCB0aGlzLmhhbmRsZVBsYXllcklkQ2hhbmdlLCBFdmVudFR5cGUuQ0hBTkdFKTsNCiAgICAgICAgICAgIHRoaXMuX3BsYXllclJhdGluZy5pbml0KCk7DQogICAgICAgICAgICB0aGlzLl9wbGF5ZXJSYXRpbmcuc2V0UGxhY2Vob2xkZXIoIlBsYXllciBSYXRpbmciKTsNCiAgICAgICAgICAgIHRoaXMuX3BsYXllclJhdGluZy5zZXRNYXhMZW5ndGgoMyk7DQogICAgICAgICAgICB0aGlzLl9wbGF5ZXJSYXRpbmcuYWRkVGFyZ2V0KHRoaXMsIHRoaXMuaGFuZGxlUGxheWVyUmF0aW5nQ2hhbmdlLCBFdmVudFR5cGUuQ0hBTkdFKTsNCg0KICAgICAgICAgICAgdGhpcy5sb2FkU2F2ZWRGaWx0ZXJzKCk7DQoNCiAgICAgICAgICAgIHRoaXMuX2dlbmVyYXRlUGFsZXNuaXBlQ2FsbGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLmdldFN0b3JlZEZpbHRlcnMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGNvbnN0IGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgicGFsZXRvb2xzOnNlYXJjaEZpbHRlcnMiKTsNCiAgICAgICAgaWYgKCFkYXRhKSByZXR1cm4ge307DQogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGF0b2IoZGF0YSkpIHx8IHt9Ow0KICAgIH0NCg0KICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLnNhdmVGaWx0ZXJzID0gZnVuY3Rpb24gKGZpbHRlcnMpIHsNCiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInBhbGV0b29sczpzZWFyY2hGaWx0ZXJzIiwgYnRvYShKU09OLnN0cmluZ2lmeShmaWx0ZXJzKSkpOw0KICAgIH0NCg0KICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLmxvYWRTYXZlZEZpbHRlcnMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGNvbnN0IHNlYXJjaEZpbHRlcnMgPSB0aGlzLmdldFN0b3JlZEZpbHRlcnMoKTsNCiAgICAgICAgbGV0IGZpbHRlcnMgPSBbeyBsYWJlbDogJy0tIFNlbGVjdCBhIGZpbHRlciB0byBsb2FkIC0tJywgdmFsdWU6ICcnIH1dOw0KICAgICAgICBmb3IgKGxldCBmaWx0ZXJLZXkgb2YgT2JqZWN0LmtleXMoc2VhcmNoRmlsdGVycykuc29ydCgpKSB7DQogICAgICAgICAgICBmaWx0ZXJzLnB1c2goeyBsYWJlbDogc2VhcmNoRmlsdGVyc1tmaWx0ZXJLZXldLm5hbWUsIHZhbHVlOiBmaWx0ZXJLZXkgfSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5fc2F2ZWRGaWx0ZXJzLnNldE9wdGlvbnMoZmlsdGVycyk7DQogICAgfQ0KDQogICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlldy5wcm90b3R5cGUuc2F2ZUZpbHRlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY29uc3QgY29udHJvbGxlciA9IGdldEN1cnJlbnRDb250cm9sbGVyKCk7DQogICAgICAgIGlmIChjb250cm9sbGVyIGluc3RhbmNlb2YgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXIpIHsNCiAgICAgICAgICAgIGNvbnN0IHNlYXJjaENyaXRlcmlhID0gY29udHJvbGxlci5fdmlld21vZGVsLnNlYXJjaENyaXRlcmlhOw0KICAgICAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMuX2ZpbHRlck5hbWUuZ2V0VmFsdWUoKTsNCiAgICAgICAgICAgIGNvbnN0IGtleSA9IG5hbWUucmVwbGFjZSgvW15hLXowLTldL2dpLCAnXycpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBjb25zdCBmaWx0ZXJzID0gdGhpcy5nZXRTdG9yZWRGaWx0ZXJzKCk7DQogICAgICAgICAgICBzZWFyY2hDcml0ZXJpYS5yYXRpbmcgPSB0aGlzLl9wbGF5ZXJSYXRpbmcuZ2V0VmFsdWUoKTsNCiAgICAgICAgICAgIGZpbHRlcnNba2V5XSA9IHsgbmFtZTogbmFtZSwgY3JpdGVyaWE6IHNlYXJjaENyaXRlcmlhIH07DQogICAgICAgICAgICB0aGlzLnNhdmVGaWx0ZXJzKGZpbHRlcnMpOw0KICAgICAgICAgICAgdGhpcy5sb2FkU2F2ZWRGaWx0ZXJzKCk7DQogICAgICAgICAgICBub3RpZnlTdWNjZXNzKCJGaWx0ZXIgc2F2ZWQiKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLmRlbGV0ZUZpbHRlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY29uc3QgY29udHJvbGxlciA9IGdldEN1cnJlbnRDb250cm9sbGVyKCk7DQogICAgICAgIGlmIChjb250cm9sbGVyIGluc3RhbmNlb2YgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXIpIHsNCiAgICAgICAgICAgIGNvbnN0IGZpbHRlcktleSA9IHRoaXMuX3NhdmVkRmlsdGVycy5nZXRWYWx1ZSgpOw0KICAgICAgICAgICAgaWYgKCFmaWx0ZXJLZXkpIHJldHVybjsNCiAgICAgICAgICAgIGNvbnN0IGZpbHRlcnMgPSB0aGlzLmdldFN0b3JlZEZpbHRlcnMoKTsNCiAgICAgICAgICAgIGRlbGV0ZSBmaWx0ZXJzW2ZpbHRlcktleV07DQogICAgICAgICAgICB0aGlzLnNhdmVGaWx0ZXJzKGZpbHRlcnMpOw0KICAgICAgICAgICAgdGhpcy5sb2FkU2F2ZWRGaWx0ZXJzKCk7DQogICAgICAgICAgICBub3RpZnlTdWNjZXNzKCJGaWx0ZXIgZGVsZXRlZCIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlldy5wcm90b3R5cGUubG9hZEZpbHRlciA9IGZ1bmN0aW9uIChmaWx0ZXIpIHsNCiAgICAgICAgY29uc3QgY29udHJvbGxlciA9IGdldEN1cnJlbnRDb250cm9sbGVyKCk7DQogICAgICAgIGlmIChjb250cm9sbGVyIGluc3RhbmNlb2YgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXIpIHsNCiAgICAgICAgICAgIGlmIChmaWx0ZXIuY3JpdGVyaWEuZGVmSWQgJiYgZmlsdGVyLmNyaXRlcmlhLmRlZklkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5ZXJJZC5zZXRWYWx1ZShmaWx0ZXIuY3JpdGVyaWEuZGVmSWRbMF0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGZpbHRlci5jcml0ZXJpYS5yYXRpbmcpIHsNCiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5ZXJSYXRpbmcuc2V0VmFsdWUoZmlsdGVyLmNyaXRlcmlhLnJhdGluZyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGxldCBrZXkgb2YgT2JqZWN0LmtleXMoZmlsdGVyLmNyaXRlcmlhKSkgew0KICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuX3ZpZXdtb2RlbC5zZWFyY2hDcml0ZXJpYVtrZXldID0gZmlsdGVyLmNyaXRlcmlhW2tleV07DQogICAgICAgICAgICAgICAgdGhpcy5zZXRGaWx0ZXJzKGNvbnRyb2xsZXIuX3ZpZXdtb2RlbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBjb25zdCBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3X3NldEZpbHRlcnMgPSBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5zZXRGaWx0ZXJzOw0KICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLnNldEZpbHRlcnMgPSBmdW5jdGlvbiBzZXRGaWx0ZXJzKGUsIHQpIHsNCiAgICAgICAgaWYgKF9lbmFibGVkICYmIGUuc2VhcmNoQ3JpdGVyaWEuZGVmSWQgJiYgZS5zZWFyY2hDcml0ZXJpYS5kZWZJZC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICB0aGlzLl9wbGF5ZXJJZC5zZXRWYWx1ZShlLnNlYXJjaENyaXRlcmlhLmRlZklkWzBdKQ0KICAgICAgICB9DQogICAgICAgIGlmIChfZW5hYmxlZCAmJiBlLnNlYXJjaENyaXRlcmlhLnJhdGluZykgew0KICAgICAgICAgICAgdGhpcy5fcGxheWVyUmF0aW5nLnNldFZhbHVlKGUuc2VhcmNoQ3JpdGVyaWEucmF0aW5nKTsNCiAgICAgICAgfQ0KICAgICAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3X3NldEZpbHRlcnMuY2FsbCh0aGlzLCBlLCB0KTsNCiAgICB9DQoNCiAgICBjb25zdCBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3X2Rlc3Ryb3lHZW5lcmF0ZWRFbGVtZW50cyA9IFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLmRlc3Ryb3lHZW5lcmF0ZWRFbGVtZW50czsNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5kZXN0cm95R2VuZXJhdGVkRWxlbWVudHMgPSBmdW5jdGlvbiBkZXN0cm95R2VuZXJhdGVkRWxlbWVudHMoKSB7DQogICAgICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdfZGVzdHJveUdlbmVyYXRlZEVsZW1lbnRzLmNhbGwodGhpcyk7DQogICAgICAgIGlmICh0aGlzLl9wbGF5ZXJJZCkgew0KICAgICAgICAgICAgdGhpcy5fcGxheWVySWQuZGVzdHJveSgpOw0KICAgICAgICAgICAgdGhpcy5fcGxheWVyUmF0aW5nLmRlc3Ryb3koKTsNCiAgICAgICAgICAgIHRoaXMuX2ZpbHRlck5hbWUuZGVzdHJveSgpOw0KICAgICAgICAgICAgdGhpcy5fc2F2ZUZpbHRlckJ1dHRvbi5kZXN0cm95KCk7DQogICAgICAgICAgICB0aGlzLl9kZWxldGVGaWx0ZXJCdXR0b24uZGVzdHJveSgpOw0KICAgICAgICAgICAgdGhpcy5fc2F2ZWRGaWx0ZXJzLmRlc3Ryb3koKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLmhhbmRsZVBsYXllcklkQ2hhbmdlID0gZnVuY3Rpb24gKF8sIF9fLCBlbGVtKSB7DQogICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBnZXRDdXJyZW50Q29udHJvbGxlcigpOw0KICAgICAgICBpZiAoY29udHJvbGxlciBpbnN0YW5jZW9mIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdDb250cm9sbGVyKSB7DQogICAgICAgICAgICBjb250cm9sbGVyLl92aWV3bW9kZWwuc2VhcmNoQ3JpdGVyaWEuZGVmSWQgPSBbZWxlbS52YWx1ZV07DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5oYW5kbGVQbGF5ZXJSYXRpbmdDaGFuZ2UgPSBmdW5jdGlvbiAoXywgX18sIGVsZW0pIHsNCiAgICAgICAgY29uc3QgY29udHJvbGxlciA9IGdldEN1cnJlbnRDb250cm9sbGVyKCk7DQogICAgICAgIGlmIChjb250cm9sbGVyIGluc3RhbmNlb2YgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXIpIHsNCiAgICAgICAgICAgIGNvbnRyb2xsZXIuX3ZpZXdtb2RlbC5zZWFyY2hDcml0ZXJpYS5yYXRpbmcgPSBlbGVtLnZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlldy5wcm90b3R5cGUub25TYXZlZEZpbHRlcnNDaGFuZ2UgPSBmdW5jdGlvbiAoXywgX18sIGVsZW0pIHsNCiAgICAgICAgY29uc3QgZmlsdGVycyA9IHRoaXMuZ2V0U3RvcmVkRmlsdGVycygpOw0KICAgICAgICBpZiAoZmlsdGVyc1tlbGVtLnZhbHVlXSkgew0KICAgICAgICAgICAgdGhpcy5sb2FkRmlsdGVyKGZpbHRlcnNbZWxlbS52YWx1ZV0pOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgY29udHJvbGxlciA9IGdldEN1cnJlbnRDb250cm9sbGVyKCk7DQogICAgICAgICAgICBpZiAoY29udHJvbGxlciBpbnN0YW5jZW9mIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdDb250cm9sbGVyKSB7DQogICAgICAgICAgICAgICAgY29udHJvbGxlci5fZVJlc2V0U2VsZWN0ZWQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGNvbnN0IFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdDb250cm9sbGVyX19lUmVzZXRTZWxlY3RlZCA9IFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdDb250cm9sbGVyLnByb3RvdHlwZS5fZVJlc2V0U2VsZWN0ZWQ7DQogICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXIucHJvdG90eXBlLl9lUmVzZXRTZWxlY3RlZCA9IGZ1bmN0aW9uIF9lUmVzZXRTZWxlY3RlZCgpIHsNCiAgICAgICAgdGhpcy5nZXRWaWV3KCkuX3BsYXllcklkLmNsZWFyKCk7DQogICAgICAgIHRoaXMuZ2V0VmlldygpLl9wbGF5ZXJSYXRpbmcuY2xlYXIoKTsNCiAgICAgICAgdGhpcy5nZXRWaWV3KCkuX2ZpbHRlck5hbWUuY2xlYXIoKTsNCiAgICAgICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXJfX2VSZXNldFNlbGVjdGVkLmNhbGwodGhpcyk7DQogICAgfQ0KDQogICAgY29uc3QgVVRQYWdpbmF0ZWRJdGVtTGlzdFZpZXdfc2V0SXRlbXMgPSBVVFBhZ2luYXRlZEl0ZW1MaXN0Vmlldy5wcm90b3R5cGUuc2V0SXRlbXM7DQogICAgVVRQYWdpbmF0ZWRJdGVtTGlzdFZpZXcucHJvdG90eXBlLnNldEl0ZW1zID0gZnVuY3Rpb24gKGUsIGkpIHsNCiAgICAgICAgY29uc3QgY29udHJvbGxlciA9IGdldEN1cnJlbnRDb250cm9sbGVyKCk7DQogICAgICAgIGlmIChfZW5hYmxlZCAmJiBjb250cm9sbGVyLl9saXN0Q29udHJvbGxlciAmJiBjb250cm9sbGVyLl9saXN0Q29udHJvbGxlciAmJiBjb250cm9sbGVyLl9saXN0Q29udHJvbGxlci5fc2VhcmNoQ3JpdGVyaWEpIHsNCiAgICAgICAgICAgIHZhciBvID0gdGhpczsNCiAgICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdFJvd3MoKTsNCg0KICAgICAgICAgICAgZS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAgICAgaWYgKHNob3VsZFJlbmRlckl0ZW0oZSwgY29udHJvbGxlci5fbGlzdENvbnRyb2xsZXIuX3NlYXJjaENyaXRlcmlhKSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IG5ldyBVVEl0ZW1UYWJsZUNlbGxWaWV3Ow0KICAgICAgICAgICAgICAgICAgICB0LnNldERhdGEoZSwgdm9pZCAwLCB2b2lkIDAsIGkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgby5saXN0Um93cy5wdXNoKHQpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3RSb3dzOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIFVUUGFnaW5hdGVkSXRlbUxpc3RWaWV3X3NldEl0ZW1zLmNhbGwodGhpcywgZSwgaSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBjb25zdCBVVE1hcmtldFNlYXJjaFZpZXdfX2dlbmVyYXRlID0gVVRNYXJrZXRTZWFyY2hWaWV3LnByb3RvdHlwZS5fZ2VuZXJhdGU7DQogICAgVVRNYXJrZXRTZWFyY2hWaWV3LnByb3RvdHlwZS5fZ2VuZXJhdGUgPSBmdW5jdGlvbiBfZ2VuZXJhdGUoKSB7DQogICAgICAgIFVUTWFya2V0U2VhcmNoVmlld19fZ2VuZXJhdGUuY2FsbCh0aGlzKTsNCiAgICAgICAgaWYgKCF0aGlzLl9nZW5lcmF0ZVBhbGVzbmlwZUNhbGxlZCkgew0KICAgICAgICAgICAgdGhpcy5fbWluTWF4UHJpY2VDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgIHRoaXMuX21pbk1heFByaWNlQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoIm1pbi1tYXgtcHJpY2VzIik7DQogICAgICAgICAgICB0aGlzLl9taW5QcmljZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgICAgICAgICB0aGlzLl9taW5QcmljZVRleHQuY2xhc3NMaXN0LmFkZCgibWluLXByaWNlLXZhbHVlIik7DQogICAgICAgICAgICB0aGlzLl9tYXhQcmljZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgICAgICAgICB0aGlzLl9tYXhQcmljZVRleHQuY2xhc3NMaXN0LmFkZCgibWF4LXByaWNlLXZhbHVlIik7DQogICAgICAgICAgICBjb25zdCBtaW5QcmljZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsNCiAgICAgICAgICAgIG1pblByaWNlQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoIm1pbi1wcmljZSIpOw0KICAgICAgICAgICAgJChtaW5QcmljZUNvbnRhaW5lcikNCiAgICAgICAgICAgICAgICAuYXBwZW5kKCc8c3BhbiBjbGFzcz0ibWluLXByaWNlLWxhYmVsIj5NaW4gQnV5IE5vdzwvc3Bhbj4nKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmQodGhpcy5fbWluUHJpY2VUZXh0KTsNCiAgICAgICAgICAgIGNvbnN0IG1heFByaWNlQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOw0KICAgICAgICAgICAgbWF4UHJpY2VDb250YWluZXIuY2xhc3NMaXN0LmFkZCgibWF4LXByaWNlIik7DQogICAgICAgICAgICAkKG1heFByaWNlQ29udGFpbmVyKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmQoJzxzcGFuIGNsYXNzPSJtYXgtcHJpY2UtbGFiZWwiPk1heCBCdXkgTm93PC9zcGFuPicpDQogICAgICAgICAgICAgICAgLmFwcGVuZCh0aGlzLl9tYXhQcmljZVRleHQpOw0KDQoNCiAgICAgICAgICAgICQodGhpcy5fbWluTWF4UHJpY2VDb250YWluZXIpDQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCJwYWxlc25pcGUtZWxlbWVudCIpDQogICAgICAgICAgICAgICAgLmhpZGUoKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmQobWluUHJpY2VDb250YWluZXIpDQogICAgICAgICAgICAgICAgLmFwcGVuZChtYXhQcmljZUNvbnRhaW5lcikNCiAgICAgICAgICAgICAgICAuaW5zZXJ0QmVmb3JlKHRoaXMuX2xpc3QuZ2V0Um9vdEVsZW1lbnQoKSk7DQoNCiAgICAgICAgICAgIHRoaXMuX21pbkJ1eU5vd1ByaWNlID0gTnVtYmVyLk1BWF9WQUxVRTsNCiAgICAgICAgICAgIHRoaXMuX21heEJ1eU5vd1ByaWNlID0gMDsNCg0KICAgICAgICAgICAgdGhpcy5fZ2VuZXJhdGVQYWxlc25pcGVDYWxsZWQgPSB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgY29uc3QgVVRNYXJrZXRTZWFyY2hWaWV3X3NldEl0ZW1zID0gVVRNYXJrZXRTZWFyY2hWaWV3LnByb3RvdHlwZS5zZXRJdGVtczsNCiAgICBVVE1hcmtldFNlYXJjaFZpZXcucHJvdG90eXBlLnNldEl0ZW1zID0gZnVuY3Rpb24gc2V0SXRlbXMoZSwgdCkgew0KICAgICAgICBpZiAodGhpcy5fc3VwZXJ2aWV3DQogICAgICAgICAgICAmJiB0aGlzLl9zdXBlcnZpZXcuX3N1cGVydmlldw0KICAgICAgICAgICAgJiYgdGhpcy5fc3VwZXJ2aWV3Ll9zdXBlcnZpZXcuX3JWaWV3IGluc3RhbmNlb2YgVVROYXZpZ2F0aW9uQ29udGFpbmVyVmlldykgew0KICAgICAgICAgICAgZm9yIChsZXQgZW50aXR5IG9mIGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoZW50aXR5Ll9hdWN0aW9uLmJ1eU5vd1ByaWNlID4gdGhpcy5fbWF4QnV5Tm93UHJpY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWF4QnV5Tm93UHJpY2UgPSBlbnRpdHkuX2F1Y3Rpb24uYnV5Tm93UHJpY2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChlbnRpdHkuX2F1Y3Rpb24uYnV5Tm93UHJpY2UgPCB0aGlzLl9taW5CdXlOb3dQcmljZSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9taW5CdXlOb3dQcmljZSA9IGVudGl0eS5fYXVjdGlvbi5idXlOb3dQcmljZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLl9taW5QcmljZVRleHQudGV4dENvbnRlbnQgPSB0aGlzLl9taW5CdXlOb3dQcmljZTsNCiAgICAgICAgICAgIHRoaXMuX21heFByaWNlVGV4dC50ZXh0Q29udGVudCA9IHRoaXMuX21heEJ1eU5vd1ByaWNlOw0KICAgICAgICAgICAgJCh0aGlzLl9taW5NYXhQcmljZUNvbnRhaW5lcikuc2hvdygpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgJCh0aGlzLl9taW5NYXhQcmljZUNvbnRhaW5lcikuaGlkZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgVVRNYXJrZXRTZWFyY2hWaWV3X3NldEl0ZW1zLmNhbGwodGhpcywgZSwgdCk7DQogICAgfQ0KDQogICAgY29uc3QgVVRJdGVtVGFibGVDZWxsVmlld19yZW5kZXIgPSBVVEl0ZW1UYWJsZUNlbGxWaWV3LnByb3RvdHlwZS5yZW5kZXI7DQogICAgVVRJdGVtVGFibGVDZWxsVmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgVVRJdGVtVGFibGVDZWxsVmlld19yZW5kZXIuY2FsbCh0aGlzLCBlKTsNCiAgICAgICAgaWYgKF9lbmFibGVkICYmIHRoaXMuZGF0YS5pc1BsYXllcigpKSB7DQogICAgICAgICAgICAkKCIudXQtaXRlbS12aWV3LS1tYWluIiwgdGhpcy5fX2VudGl0eUNvbnRhaW5lcikuYXBwZW5kKGA8c3BhbiBjbGFzcz0icGxheWVyLWRlZmluaXRpb24taWQiPiR7dGhpcy5kYXRhLmRlZmluaXRpb25JZH08L3NwYW4+YCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzaG91bGRSZW5kZXJJdGVtKGl0ZW0sIHNlYXJjaENyaXRlcmlhKSB7DQogICAgICAgIGxldCByYXRpbmcgPSBzZWFyY2hDcml0ZXJpYS5yYXRpbmc7DQoNCiAgICAgICAgaWYgKCFfZW5hYmxlZCB8fCAhcmF0aW5nKSByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICBpZiAocmF0aW5nLmNoYXJBdCgwKSA9PT0gIisiKSB7DQogICAgICAgICAgICByYXRpbmcgPSBwYXJzZUludChyYXRpbmcuc3Vic3RyKDEpKTsNCiAgICAgICAgICAgIHJldHVybiBpdGVtLnJhdGluZyA+PSByYXRpbmc7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAocmF0aW5nLmNoYXJBdCgwKSA9PT0gIi0iKSB7DQogICAgICAgICAgICByYXRpbmcgPSBwYXJzZUludChyYXRpbmcuc3Vic3RyKDEpKTsNCiAgICAgICAgICAgIHJldHVybiBpdGVtLnJhdGluZyA8PSByYXRpbmc7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByYXRpbmcgPSBwYXJzZUludChyYXRpbmcpOw0KICAgICAgICAgICAgcmV0dXJuIGl0ZW0ucmF0aW5nID09IHJhdGluZzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGNvbnN0IFVUSXRlbURvbWFpblJlcG9zaXRvcnlfaXNQaWxlRnVsbCA9IFVUSXRlbURvbWFpblJlcG9zaXRvcnkucHJvdG90eXBlLmlzUGlsZUZ1bGw7DQogICAgVVRJdGVtRG9tYWluUmVwb3NpdG9yeS5wcm90b3R5cGUuaXNQaWxlRnVsbCA9IGZ1bmN0aW9uIChlKSB7DQogICAgICAgIGlmICghX2VuYWJsZWQpIHsNCiAgICAgICAgICAgIFVUSXRlbURvbWFpblJlcG9zaXRvcnlfaXNQaWxlRnVsbC5jYWxsKHRoaXMsIGUpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHQgPSAwDQogICAgICAgICAgICAsIGkgPSB0aGlzLnBpbGVTaXplcy5nZXQoZSk7DQogICAgICAgIHN3aXRjaCAoZSkgew0KICAgICAgICAgICAgY2FzZSBJdGVtUGlsZS5QVVJDSEFTRUQ6DQogICAgICAgICAgICAgICAgdCA9IHRoaXMudW5hc3NpZ25lZC5sZW5ndGg7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIEl0ZW1QaWxlLlRSQU5TRkVSOg0KICAgICAgICAgICAgICAgIHQgPSB0aGlzLnRyYW5zZmVyLmxlbmd0aDsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgSXRlbVBpbGUuSU5CT1g6DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICBjYXNlIEl0ZW1QaWxlLkNMVUI6DQogICAgICAgICAgICAgICAgcmV0dXJuICExDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIChpIHx8IDApIDw9IHQNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhZGRBY3Rpb25zVG9BY3Rpb25QYW5lbChjbGFzc05hbWUsIGJ1dHRvbnNDb250YWluZXJGdW5jKXsNCiAgICAgICAgY29uc3QgZ2VuZXJhdGUgPSBjbGFzc05hbWUucHJvdG90eXBlLl9nZW5lcmF0ZTsNCiAgICAgICAgY2xhc3NOYW1lLnByb3RvdHlwZS5fZ2VuZXJhdGUgPSBmdW5jdGlvbiBfZ2VuZXJhdGUoKSB7DQogICAgICAgICAgICBnZW5lcmF0ZS5jYWxsKHRoaXMpOw0KICAgICAgICAgICAgaWYgKCF0aGlzLl9nZW5lcmF0ZVBhbGVzbmlwZUNhbGxlZCkgew0KICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuX2NvcHlQbGF5ZXJJZEJ1dHRvbiA9IG5ldyBVVEdyb3VwQnV0dG9uQ29udHJvbCgpOw0KICAgICAgICAgICAgICAgIHRoaXMuX2NvcHlQbGF5ZXJJZEJ1dHRvbi5pbml0KCk7DQogICAgICAgICAgICAgICAgdGhpcy5fY29weVBsYXllcklkQnV0dG9uLnNldFRleHQoIkNvcHkgcGxheWVyIElEIHRvIGNsaXBib2FyZCIpOw0KICAgICAgICAgICAgICAgIHRoaXMuX2NvcHlQbGF5ZXJJZEJ1dHRvbi5hZGRUYXJnZXQodGhpcywgKCkgPT4gdGhpcy5vbkNvcHlQbGF5ZXJJZC5ub3RpZnkoKSwgRXZlbnRUeXBlLlRBUCk7DQogICAgICAgICAgICAgICAgdGhpcy5vbkNvcHlQbGF5ZXJJZCA9IG5ldyBFQU9ic2VydmFibGUoKTsNCg0KICAgICAgICAgICAgICAgIHRoaXMuX2Z1dGJpblNlYXJjaEJ1dHRvbiA9IG5ldyBVVEdyb3VwQnV0dG9uQ29udHJvbCgpOw0KICAgICAgICAgICAgICAgIHRoaXMuX2Z1dGJpblNlYXJjaEJ1dHRvbi5pbml0KCk7DQogICAgICAgICAgICAgICAgdGhpcy5fZnV0YmluU2VhcmNoQnV0dG9uLnNldFRleHQoIlZpZXcgaW4gZnV0YmluIik7DQogICAgICAgICAgICAgICAgdGhpcy5fZnV0YmluU2VhcmNoQnV0dG9uLmFkZFRhcmdldCh0aGlzLCAoKSA9PiB0aGlzLm9uRnV0YmluU2VhcmNoLm5vdGlmeSgpLCBFdmVudFR5cGUuVEFQKTsNCiAgICAgICAgICAgICAgICB0aGlzLm9uRnV0YmluU2VhcmNoID0gbmV3IEVBT2JzZXJ2YWJsZSgpOw0KICAgIA0KICAgIA0KICAgICAgICAgICAgICAgIGJ1dHRvbnNDb250YWluZXJGdW5jKHRoaXMpLmFwcGVuZENoaWxkKHRoaXMuX2NvcHlQbGF5ZXJJZEJ1dHRvbi5nZXRSb290RWxlbWVudCgpKTsNCiAgICAgICAgICAgICAgICBidXR0b25zQ29udGFpbmVyRnVuYyh0aGlzKS5hcHBlbmRDaGlsZCh0aGlzLl9mdXRiaW5TZWFyY2hCdXR0b24uZ2V0Um9vdEVsZW1lbnQoKSk7DQogICAgDQogICAgICAgICAgICAgICAgdGhpcy5fZ2VuZXJhdGVQYWxlc25pcGVDYWxsZWQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIGNvbnN0IF9kZXN0cm95R2VuZXJhdGVkRWxlbWVudHMgPSBjbGFzc05hbWUucHJvdG90eXBlLmRlc3Ryb3lHZW5lcmF0ZWRFbGVtZW50czsNCiAgICAgICAgY2xhc3NOYW1lLnByb3RvdHlwZS5kZXN0cm95R2VuZXJhdGVkRWxlbWVudHMgPSBmdW5jdGlvbiBkZXN0cm95R2VuZXJhdGVkRWxlbWVudHMoKSB7DQogICAgICAgICAgICBfZGVzdHJveUdlbmVyYXRlZEVsZW1lbnRzLmNhbGwodGhpcyk7DQogICAgICAgICAgICB0aGlzLl9jb3B5UGxheWVySWRCdXR0b24uZGVzdHJveSgpOw0KICAgICAgICAgICAgdGhpcy5fZnV0YmluU2VhcmNoQnV0dG9uLmRlc3Ryb3koKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IGRlYWxsb2MgPSBjbGFzc05hbWUucHJvdG90eXBlLmRlYWxsb2M7DQogICAgICAgIGNsYXNzTmFtZS5wcm90b3R5cGUuZGVhbGxvYyA9IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICBkZWFsbG9jLmNhbGwodGhpcyk7DQogICAgICAgICAgICB0aGlzLm9uQ29weVBsYXllcklkLmRlYWxsb2MoKTsNCiAgICAgICAgICAgIHRoaXMub25GdXRiaW5TZWFyY2guZGVhbGxvYygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgYWRkQWN0aW9uc1RvQWN0aW9uUGFuZWwoVVREZWZhdWx0QWN0aW9uUGFuZWxWaWV3LCBpbnN0YW5jZSA9PiBpbnN0YW5jZS5fX2l0ZW1BY3Rpb25zKTsNCiAgICBhZGRBY3Rpb25zVG9BY3Rpb25QYW5lbChVVEF1Y3Rpb25BY3Rpb25QYW5lbFZpZXcsIGluc3RhbmNlID0+ICQoIi51dC1idXR0b24tZ3JvdXAiLCBpbnN0YW5jZS5nZXRSb290RWxlbWVudCgpKVswXSk7DQoNCiAgICBjb25zdCBJdGVtRGV0YWlsc19fZ2V0UGFuZWxWaWV3SW5zdGFuY2VGcm9tRGF0YSA9IGNvbnRyb2xsZXJzLml0ZW1zLkl0ZW1EZXRhaWxzLnByb3RvdHlwZS5fZ2V0UGFuZWxWaWV3SW5zdGFuY2VGcm9tRGF0YTsNCiAgICBjb250cm9sbGVycy5pdGVtcy5JdGVtRGV0YWlscy5wcm90b3R5cGUuX2dldFBhbmVsVmlld0luc3RhbmNlRnJvbURhdGEgPSBmdW5jdGlvbiBfZ2V0UGFuZWxWaWV3SW5zdGFuY2VGcm9tRGF0YShlLCB0KSB7DQogICAgICAgIEl0ZW1EZXRhaWxzX19nZXRQYW5lbFZpZXdJbnN0YW5jZUZyb21EYXRhLmNhbGwodGhpcywgZSwgdCk7DQogICAgICAgIGlmKHRoaXMuX3BhbmVsIGluc3RhbmNlb2YgVVREZWZhdWx0QWN0aW9uUGFuZWxWaWV3IHx8IHRoaXMuX3BhbmVsIGluc3RhbmNlb2YgVVRBdWN0aW9uQWN0aW9uUGFuZWxWaWV3KXsNCiAgICAgICAgICAgIHRoaXMuX3BhbmVsLm9uQ29weVBsYXllcklkLm9ic2VydmUodGhpcywgdGhpcy5fb25Db3B5UGxheWVySWQpOw0KICAgICAgICAgICAgdGhpcy5fcGFuZWwub25GdXRiaW5TZWFyY2gub2JzZXJ2ZSh0aGlzLCB0aGlzLl9vbkZ1dGJpblNlYXJjaCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBjb250cm9sbGVycy5pdGVtcy5JdGVtRGV0YWlscy5wcm90b3R5cGUuX29uQ29weVBsYXllcklkID0gZnVuY3Rpb24oKXsNCiAgICAgICAgY29weVRvQ2xpcGJvYXJkKHRoaXMuX3ZpZXdtb2RlbC5jdXJyZW50KCkuZGVmaW5pdGlvbklkKTsNCiAgICAgICAgbm90aWZ5U3VjY2VzcygiUGxheWVyIElEIGNvcGllZCB0byBjbGlwYm9hcmQhIik7DQogICAgfQ0KDQogICAgY29udHJvbGxlcnMuaXRlbXMuSXRlbURldGFpbHMucHJvdG90eXBlLl9vbkZ1dGJpblNlYXJjaCA9IGZ1bmN0aW9uKCl7DQogICAgICAgIHdpbmRvdy5vcGVuKGBodHRwczovL3d3dy5mdXRiaW4uY29tL3BsYXllcnM/cGFnZT0xJnNlYXJjaD0ke3RoaXMuX3ZpZXdtb2RlbC5jdXJyZW50KCkuX3N0YXRpY0RhdGEuZmlyc3ROYW1lfSUyMCR7dGhpcy5fdmlld21vZGVsLmN1cnJlbnQoKS5fc3RhdGljRGF0YS5sYXN0TmFtZX1gKTsNCiAgICB9DQoNCiAgICBjb25zdCBVVEdhbWVUYWJCYXJDb250cm9sbGVyX2luaXRXaXRoVmlld0NvbnRyb2xsZXJzID0gVVRHYW1lVGFiQmFyQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGhWaWV3Q29udHJvbGxlcnM7DQogICAgVVRHYW1lVGFiQmFyQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGhWaWV3Q29udHJvbGxlcnMgPSBmdW5jdGlvbiAodGFicykgew0KICAgICAgICBjb25zdCBwYWxlc25pcGVOYXYgPSBuZXcgVVRHYW1lRmxvd05hdmlnYXRpb25Db250cm9sbGVyKCk7DQogICAgICAgIHBhbGVzbmlwZU5hdi5pbml0V2l0aFJvb3RDb250cm9sbGVyKG5ldyBQYWxlc25pcGVTZXR0aW5nc0NvbnRyb2xsZXIoKSk7DQogICAgICAgIHBhbGVzbmlwZU5hdi50YWJCYXJJdGVtID0gZ2VuZXJhdGVQYWxlc25pcGVTZXR0aW5nc1RhYigpOw0KICAgICAgICB0YWJzLnB1c2gocGFsZXNuaXBlTmF2KTsNCiAgICAgICAgVVRHYW1lVGFiQmFyQ29udHJvbGxlcl9pbml0V2l0aFZpZXdDb250cm9sbGVycy5jYWxsKHRoaXMsIHRhYnMpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdlbmVyYXRlUGFsZXNuaXBlU2V0dGluZ3NUYWIoKSB7DQogICAgICAgIGNvbnN0IHRhYiA9IG5ldyBVVFRhYkJhckl0ZW1WaWV3KCk7DQogICAgICAgIHRhYi5pbml0KCk7DQogICAgICAgIHRhYi5zZXRUYWcoNik7DQogICAgICAgIHRhYi5zZXRUZXh0KCJQYWxlc25pcGUgU2V0dGluZ3MiKTsNCiAgICAgICAgdGFiLmFkZENsYXNzKCJpY29uLXRyYW5zZmVyIik7DQogICAgICAgIHRhYi5nZXRSb290RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoInBhbGVzbmlwZS1lbGVtZW50Iik7DQogICAgICAgIHJldHVybiB0YWI7DQogICAgfQ0KDQogICAgY29uc3QNCiAgICAgICAgbCA9IGNvbnNvbGUubG9nLA0KICAgICAgICBsb2MgPSB3aW5kb3cuc2VydmljZXMuTG9jYWxpemF0aW9uLA0KICAgICAgICBkaXNwYXRjaE1vdXNlRXZlbnQgPSAoJHRhcmdldCwgZXZlbnROYW1lKSA9PiB7DQogICAgICAgICAgICBpZiAoJHRhcmdldC5sZW5ndGggPT0gMCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgY29uc3QgbW91c2VFdmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpOw0KICAgICAgICAgICAgbW91c2VFdmVudC5pbml0RXZlbnQoZXZlbnROYW1lKTsNCiAgICAgICAgICAgICR0YXJnZXRbMF0uZGlzcGF0Y2hFdmVudChtb3VzZUV2ZW50KTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9LA0KICAgICAgICBtb3VzZURvd24gPSB0YXJnZXQgPT4gZGlzcGF0Y2hNb3VzZUV2ZW50KHRhcmdldCwgJ21vdXNlZG93bicpLA0KICAgICAgICBtb3VzZVVwID0gdGFyZ2V0ID0+IGRpc3BhdGNoTW91c2VFdmVudCh0YXJnZXQsICdtb3VzZXVwJyksDQogICAgICAgIG1vdXNlQ2xpY2sgPSAodGFyZ2V0LCBkZWxheSwgY2FsbGJhY2spID0+IHsNCiAgICAgICAgICAgIGlmIChkZWxheSkgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhtb3VzZUNsaWNrKHRhcmdldCkpOw0KICAgICAgICAgICAgICAgIH0sIGRlbGF5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBtb3VzZURvd24odGFyZ2V0KSAmJiBtb3VzZVVwKHRhcmdldCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGJ1eU5vdyA9IChjYWxsYmFjaykgPT4gew0KICAgICAgICAgICAgaWYgKG1vdXNlQ2xpY2soYnV5QnRuKCkpKSB7DQogICAgICAgICAgICAgICAgaWYgKF9wYWxlc25pcGVTZXR0aW5ncy5idXR0b25zLnJlc3VsdHMucHJlc3NFbnRlcikgew0KICAgICAgICAgICAgICAgICAgICB0cnlQcmVzc09rQnRuKGNhbGxiYWNrKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHRyeVByZXNzT2tCdG4gPSAoY2FsbGJhY2spID0+IHsNCiAgICAgICAgICAgIGlmICghbW91c2VDbGljayhlbnRlckJ0bigpKSkgew0KICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgew0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNhbGxiYWNrKGZhbHNlKSwgMCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgc2V0VGltZW91dCh0cnlQcmVzc09rQnRuLCAxMCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHRydWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB1cGRhdGVCb3VnaHRVSSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBiYWNrID0gKCkgPT4gew0KICAgICAgICAgICAgbCgnYmFjaycpOw0KICAgICAgICAgICAgaWYgKCFtb3VzZUNsaWNrKGJhY2tCdG4oKSkpIHsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGJhY2ssIDEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIHNlYXJjaCA9ICgpID0+IHsNCiAgICAgICAgICAgIG1vdXNlQ2xpY2soc2VhcmNoQnRuKCkpOw0KICAgICAgICAgICAgaWYgKF9wYWxlc25pcGVTZXR0aW5ncy5idXR0b25zLnJlc3VsdHMuYXV0b0J1eSkgew0KICAgICAgICAgICAgICAgIGlmIChzZWFyY2hSZXN1bHRzKCkgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBsKCdyZXNlYXJjaGluZycpOw0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHNlYXJjaCwgMTApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbCgkKCIudXQtbm8tcmVzdWx0cy12aWV3IikubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCQoIi51dC1uby1yZXN1bHRzLXZpZXciKS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsKCdubyByZXN1bHRzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBiYWNrKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsKCdidXlpbmcnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1eU5vdygoYm91Z2h0KSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJvdWdodCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VzZUNsaWNrKHRyYW5zZmVyQnRuKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIHRyYW5zZmVyQnRuID0gKCkgPT4gJChgLnV0LWJ1dHRvbi1ncm91cCA+IGJ1dHRvbjpjb250YWlucygnJHtsb2MubG9jYWxpemUoJ2luZm9wYW5lbC5sYWJlbC5zZW5kVHJhZGVQaWxlJyl9JylgKSwNCiAgICAgICAgY2x1YkJ0biA9ICgpID0+ICQoYC51dC1idXR0b24tZ3JvdXAgPiBidXR0b246Y29udGFpbnMoJyR7bG9jLmxvY2FsaXplKCdpbmZvcGFuZWwubGFiZWwuc3RvcmVJbkNsdWInKX0nKWApLA0KICAgICAgICBzZWxsQnRuID0gKCkgPT4gJChgLnV0LWJ1dHRvbi1ncm91cCA+IGJ1dHRvbjpjb250YWlucygnJHtsb2MubG9jYWxpemUoJ2luZm9wYW5lbC5sYWJlbC5kaXNjYXJkJyl9JylgKSwNCiAgICAgICAgYnV5QnRuID0gKCkgPT4gJCgnLmJ1eUJ1dHRvbicpLA0KICAgICAgICBiYWNrQnRuID0gKCkgPT4gJCgnLnV0LW5hdmlnYXRpb24tYnV0dG9uLWNvbnRyb2wnKSwNCiAgICAgICAgZW50ZXJCdG4gPSAoKSA9PiAkKCcuZWEtZGlhbG9nLXZpZXcgLnV0LWJ1dHRvbi1ncm91cCBidXR0b246ZXEoMCknKSwNCiAgICAgICAgc2VhcmNoQnRuID0gKCkgPT4gJCgnLmJ1dHRvbi1jb250YWluZXIgLmJ0bi1zdGFuZGFyZC5jYWxsLXRvLWFjdGlvbicpLA0KICAgICAgICBzZWFyY2hSZXN1bHRzID0gKCkgPT4gJCgnLlNlYXJjaFJlc3VsdHMnKS5sZW5ndGgsDQoNCg0KICAgICAgICBrZXlzID0gKHApID0+IHsNCiAgICAgICAgICAgIGxldCBiID0ge307DQoNCiAgICAgICAgICAgIGJbcC5iYWNrXSA9ICgpID0+IGJhY2soKTsNCg0KICAgICAgICAgICAgaWYgKCQoJy51dC1tYXJrZXQtc2VhcmNoLWZpbHRlcnMtdmlldycpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBiW3Auc2VhcmNoLmRlY01pbkJpZF0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5kZWNyZW1lbnQtdmFsdWUnKSk7DQogICAgICAgICAgICAgICAgYltwLnNlYXJjaC5pbmNNaW5CaWRdID0gKCkgPT4gbW91c2VDbGljaygkKCcuaW5jcmVtZW50LXZhbHVlJykpOw0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guZGVjTWF4QmlkXSA9ICgpID0+IG1vdXNlQ2xpY2soJCgnLmRlY3JlbWVudC12YWx1ZTplcSgxKScpKTsNCiAgICAgICAgICAgICAgICBiW3Auc2VhcmNoLmluY01heEJpZF0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5pbmNyZW1lbnQtdmFsdWU6ZXEoMSknKSk7DQogICAgICAgICAgICAgICAgYltwLnNlYXJjaC5kZWNNaW5CdXldID0gKCkgPT4gbW91c2VDbGljaygkKCcuZGVjcmVtZW50LXZhbHVlOmVxKDIpJykpOw0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guaW5jTWluQnV5XSA9ICgpID0+IG1vdXNlQ2xpY2soJCgnLmluY3JlbWVudC12YWx1ZTplcSgyKScpKTsNCiAgICAgICAgICAgICAgICBiW3Auc2VhcmNoLmRlY01heEJ1eV0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5kZWNyZW1lbnQtdmFsdWU6ZXEoMyknKSk7DQogICAgICAgICAgICAgICAgYltwLnNlYXJjaC5pbmNNYXhCdXldID0gKCkgPT4gbW91c2VDbGljaygkKCcuaW5jcmVtZW50LXZhbHVlOmVxKDMpJykpOw0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guc2VhcmNoXSA9ICgpID0+IHNlYXJjaCgpOw0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2gucmVzZXRCaWRdID0gKCkgPT4gbW91c2VDbGljaygkKCcuc2VhcmNoLXByaWNlLWhlYWRlciA+IGJ1dHRvbjpmaXJzdCcpKTsNCiAgICAgICAgICAgICAgICBiW3Auc2VhcmNoLmJvdE1vZGVNaW5CaWRdID0gKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAocC5zZWFyY2guZW5hYmxlQm90TW9kZSAmJiBiW3Auc2VhcmNoLmluY01pbkJpZF0oKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guYm90TW9kZU1pbkJ1eV0gPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwLnNlYXJjaC5lbmFibGVCb3RNb2RlICYmIGJbcC5zZWFyY2guaW5jTWluQnV5XSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2goKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGxldCBpdGVtcyA9ICQoIi5saXN0RlVUSXRlbSIpOw0KICAgICAgICAgICAgICAgIGxldCBpdGVtc0V4aXN0cyA9IGl0ZW1zLmxlbmd0aCA+IDA7DQogICAgICAgICAgICAgICAgbGV0IGl0ZW1zQ29udGFpbmVyID0gaXRlbXMucGFyZW50cygnLnBhZ2luYXRlZCwgLnV0LXdhdGNoLWxpc3QtdmlldywgLnV0LXRyYW5zZmVyLWxpc3QtdmlldycpOw0KICAgICAgICAgICAgICAgIGlmIChpdGVtc0NvbnRhaW5lci5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBpdGVtc0NvbnRhaW5lciA9IGl0ZW1zLnBhcmVudCgpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChpdGVtc0V4aXN0cyAmJiAkKCcuRGV0YWlsUGFuZWwgPiAuYmlkT3B0aW9ucycpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgYltwLnJlc3VsdHMuYmlkXSA9ICgpID0+IG1vdXNlQ2xpY2soJCgnLmJpZEJ1dHRvbicpKTsNCiAgICAgICAgICAgICAgICAgICAgYltwLnJlc3VsdHMuYnV5XSA9ICgpID0+IGJ1eU5vdygpOw0KICAgICAgICAgICAgICAgICAgICBiW3AucmVzdWx0cy5kZWNCaWRdID0gKCkgPT4gbW91c2VDbGljaygkKCcuYmlkT3B0aW9ucyAuZGVjcmVtZW50LXZhbHVlJykpOw0KICAgICAgICAgICAgICAgICAgICBiW3AucmVzdWx0cy5pbmNCaWRdID0gKCkgPT4gbW91c2VDbGljaygkKCcuYmlkT3B0aW9ucyAuaW5jcmVtZW50LXZhbHVlJykpOw0KICAgICAgICAgICAgICAgICAgICBiW3Auc2VhcmNoLmJvdE1vZGVNaW5CaWRdID0gKCkgPT4gcC5zZWFyY2guZW5hYmxlQm90TW9kZSA/IGJ1eU5vdygpIDogZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guYm90TW9kZU1pbkJ1eV0gPSAoKSA9PiBwLnNlYXJjaC5lbmFibGVCb3RNb2RlID8gYnV5Tm93KCkgOiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoaXRlbXNFeGlzdHMgJiYgJCgnLkRldGFpbFBhbmVsID4gLnV0LWJ1dHRvbi1ncm91cCcpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgYltwLnJlc3VsdHMudHJhbnNmZXJdID0gKCkgPT4gbW91c2VDbGljayh0cmFuc2ZlckJ0bigpKTsNCiAgICAgICAgICAgICAgICAgICAgYltwLnJlc3VsdHMuY2x1Yl0gPSAoKSA9PiBtb3VzZUNsaWNrKGNsdWJCdG4oKSk7DQogICAgICAgICAgICAgICAgICAgIGJbcC5yZXN1bHRzLnNlbGxdID0gKCkgPT4gbW91c2VDbGljayhzZWxsQnRuKCkpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChpdGVtc0V4aXN0cykgew0KICAgICAgICAgICAgICAgICAgICBiW3AubGlzdHMudXBdID0gKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbnRhaW5lciA9IGl0ZW1zQ29udGFpbmVyOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkID0gJCgnLmxpc3RGVVRJdGVtLnNlbGVjdGVkJywgY29udGFpbmVyKS5wcmV2KCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWQubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSAkKCIubGlzdEZVVEl0ZW06bGFzdC1jaGlsZCIsIGNvbnRhaW5lcik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBtb3VzZUNsaWNrKHNlbGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jc3MoJ3Bvc2l0aW9uJywgJ3JlbGF0aXZlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wKGNvbnRhaW5lci5zY3JvbGxUb3AoKSArIHNlbGVjdGVkLnBvc2l0aW9uKCkudG9wIC0gc2VsZWN0ZWQuaGVpZ2h0KCkpOw0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBiW3AubGlzdHMuZG93bl0gPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29udGFpbmVyID0gaXRlbXNDb250YWluZXI7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWQgPSAkKCcubGlzdEZVVEl0ZW0uc2VsZWN0ZWQnLCBjb250YWluZXIpLm5leHQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9ICQoIi5saXN0RlVUSXRlbTpmaXJzdC1jaGlsZCIsIGNvbnRhaW5lcik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBtb3VzZUNsaWNrKHNlbGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jc3MoJ3Bvc2l0aW9uJywgJ3JlbGF0aXZlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wKGNvbnRhaW5lci5zY3JvbGxUb3AoKSArIHNlbGVjdGVkLnBvc2l0aW9uKCkudG9wKTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guYm90TW9kZU1pbkJpZF0gPSAoKSA9PiBwLnNlYXJjaC5lbmFibGVCb3RNb2RlID8gYmFjaygpIDogZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guYm90TW9kZU1pbkJ1eV0gPSAoKSA9PiBwLnNlYXJjaC5lbmFibGVCb3RNb2RlID8gYmFjaygpIDogZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKCQoJy5wYWdpbmdDb250YWluZXInKS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIGJbcC5saXN0cy5wcmV2XSA9ICgpID0+IG1vdXNlQ2xpY2soJCgnLnBhZ2luZ0NvbnRhaW5lciAucHJldjp2aXNpYmxlJykpOw0KICAgICAgICAgICAgICAgICAgICBiW3AubGlzdHMubmV4dF0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5wYWdpbmdDb250YWluZXIgLm5leHQ6dmlzaWJsZScpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9Ow0KDQogICAgLy8gVUkgdXBkYXRlIGFmdGVyIGJ1eSBub3cNCiAgICBjb25zdCB1cGRhdGVCb3VnaHRVSSA9ICgpID0+IHsNCiAgICAgICAgaWYgKCFfZW5hYmxlZCkgcmV0dXJuOw0KDQogICAgICAgIHZhciB0eEJ0biA9IHRyYW5zZmVyQnRuKCk7DQogICAgICAgIGlmICh0eEJ0bi5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgc2V0VGltZW91dCh1cGRhdGVCb3VnaHRVSSwgNTApOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IHVwZCA9ICh0LCB0eCkgPT4gew0KICAgICAgICAgICAgaWYgKCF0KSByZXR1cm47DQogICAgICAgICAgICBsZXQgYWRkID0gYCBbICR7X3BhbGVzbmlwZVNldHRpbmdzLmJ1dHRvbnMucmVzdWx0c1t0eF19IF1gOw0KICAgICAgICAgICAgbGV0IGh0bWwgPSB0Lmh0bWwoKTsNCiAgICAgICAgICAgIGlmIChodG1sICYmIGh0bWwuaW5kZXhPZihhZGQpID09IC0xKSB7DQogICAgICAgICAgICAgICAgdC5odG1sKHQuaHRtbCgpICsgYWRkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHVwZCh0eEJ0biwgJ3RyYW5zZmVyJyk7DQogICAgICAgIHVwZChjbHViQnRuKCksICdjbHViJyk7DQogICAgICAgIHVwZChzZWxsQnRuKCksICdzZWxsJyk7DQogICAgfTsNCg0KICAgIGNvbnN0IGFkZENzcyA9IChwKSA9PiB7DQogICAgICAgIGxldCBidG4gPSAocSwgazEsIGsyLCBpbmMpID0+IGAke3F9IC4keyhpbmMgPyAnaW4nIDogJ2RlJyl9Y3JlbWVudC12YWx1ZTphZnRlciB7IGZvbnQtc2l6ZToxMHB4OyBkaXNwbGF5OmJsb2NrOyBtYXJnaW4tdG9wOi0zMHB4OyBjb250ZW50OiAnWyAke3BbazFdW2syXX0gXScgfWA7DQogICAgICAgIGxldCBzcDEgPSAoaSwgaywgaW5jKSA9PiBidG4oYC5zZWFyY2gtcHJpY2VzIC5wcmljZS1maWx0ZXI6bnRoLWNoaWxkKCR7aX0pYCwgJ3NlYXJjaCcsIGssIGluYyk7DQogICAgICAgIGxldCBzcDIgPSAoaSwgazEsIGsyKSA9PiBgJHtzcDEoaSwgazEpfSR7c3AxKGksIGsyLCB0cnVlKX1gOw0KICAgICAgICBsZXQgY3NzID0gYA0KICAgICAgICAgICAgJHtzcDIoMiwgJ2RlY01pbkJpZCcsICdpbmNNaW5CaWQnKX0NCiAgICAgICAgICAgICR7c3AyKDMsICdkZWNNYXhCaWQnLCAnaW5jTWF4QmlkJyl9DQogICAgICAgICAgICAke3NwMig1LCAnZGVjTWluQnV5JywgJ2luY01pbkJ1eScpfQ0KICAgICAgICAgICAgJHtzcDIoNiwgJ2RlY01heEJ1eScsICdpbmNNYXhCdXknKX0NCiAgICAgICAgICAgICR7YnRuKCcuRGV0YWlsUGFuZWwgPiAuYmlkT3B0aW9ucycsICdyZXN1bHRzJywgJ2RlY0JpZCcsIGZhbHNlKX0NCiAgICAgICAgICAgICR7YnRuKCcuRGV0YWlsUGFuZWwgPiAuYmlkT3B0aW9ucycsICdyZXN1bHRzJywgJ2luY0JpZCcsIHRydWUpfQ0KICAgICAgICAgICAgLnV0LW1hcmtldC1zZWFyY2gtZmlsdGVycy12aWV3IC5jYWxsLXRvLWFjdGlvbjphZnRlciB7IGNvbnRlbnQ6ICdbICR7cC5zZWFyY2guc2VhcmNofV0nfQ0KICAgICAgICAgICAgLnV0LW1hcmtldC1zZWFyY2gtZmlsdGVycy12aWV3IC5zZWFyY2gtcHJpY2UtaGVhZGVyOmZpcnN0LWNoaWxkID4gYnV0dG9uOmFmdGVyIHsgY29udGVudDogJ1sgJHtwLnNlYXJjaC5yZXNldEJpZH1dJzsgIGZvbnQtc2l6ZTogMTBweDsgZGlzcGxheTogYmxvY2sgIH0NCiAgICAgICAgICAgIC51dC1uYXZpZ2F0aW9uLWJ1dHRvbi1jb250cm9sOmFmdGVyIHsgZm9udC1zaXplOjEwcHg7IGZsb2F0OnJpZ2h0OyBtYXJnaW4tcmlnaHQ6MTJweDsgY29udGVudDogJ1sgJHtwLmJhY2t9IF0nIH0NCiAgICAgICAgICAgIC5wYWdpbmdDb250YWluZXIgLnByZXY6YWZ0ZXIgeyBmb250LXNpemU6IDEwcHg7IGRpc3BsYXk6YmxvY2s7IGNvbnRlbnQ6ICdbICR7cC5saXN0cy5wcmV2fSBdJyB9DQogICAgICAgICAgICAucGFnaW5nQ29udGFpbmVyIC5uZXh0OmFmdGVyIHsgZm9udC1zaXplOiAxMHB4OyBkaXNwbGF5OmJsb2NrOyBjb250ZW50OiAnWyAke3AubGlzdHMubmV4dH0gXScgfQ0KICAgICAgICAgICAgLmJpZEJ1dHRvbjphZnRlciB7IGNvbnRlbnQ6ICcgWyAke3AucmVzdWx0cy5iaWR9IF0nIH0NCiAgICAgICAgICAgIC5idXlCdXR0b246YmVmb3JlIHsgZmxvYXQ6cmlnaHQ7IGNvbnRlbnQ6ICcgWyAke3AucmVzdWx0cy5idXl9IF0nIH0NCiAgICAgICAgICAgIC5wbGF5ZXItZGVmaW5pdGlvbi1pZCB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgYm90dG9tOiAwOyB9DQogICAgICAgICAgICAuc2F2ZWQtZmlsdGVycyB7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgbWFyZ2luLWxlZnQ6IDhweDsgbWFyZ2luLWJvdHRvbTogOHB4O30NCiAgICAgICAgICAgIC5zYXZlZC1maWx0ZXJzID4gaW5wdXQge2Rpc3BsYXk6IGlubGluZS1ibG9jazsgd2lkdGg6IGF1dG87IH0NCiAgICAgICAgICAgIC5zYXZlZC1maWx0ZXJzID4gYnV0dG9uIHsgZGlzcGxheTogaW5saW5lLWJsb2NrOyBtYXJnaW4tbGVmdDogOHB4O30NCiAgICAgICAgICAgIC5zYXZlZC1maWx0ZXJzID4gZGl2IHsgZmxvYXQ6IHJpZ2h0OyBtYXJnaW4tbGVmdDogOHB4O30NCiAgICAgICAgICAgIC5taW4tcHJpY2UtbGFiZWwsIC5tYXgtcHJpY2UtbGFiZWwgeyBjb2xvcjogIzg4OTA5YjsgbWFyZ2luLXJpZ2h0OiAycHg7IH0NCiAgICAgICAgICAgIC5taW4tcHJpY2UtbGFiZWw6YWZ0ZXIsIC5tYXgtcHJpY2UtbGFiZWw6YWZ0ZXIgeyBjb250ZW50OiAnOicgfQ0KICAgICAgICAgICAgLm1pbi1tYXgtcHJpY2VzIHsgZm9udC1zaXplOiAxNHB4OyB9DQogICAgICAgICAgICAubWF4LXByaWNlIHsgZmxvYXQ6IHJpZ2h0OyB9DQogICAgICAgICAgICAjcGFsZXNuaXBlLWRvbmF0aW9uLXVpIHsgZmxvYXQ6IGxlZnQ7IG1hcmdpbi1sZWZ0OiAyMHB4OyBsaW5lLWhlaWdodDogNTBweDt9DQogICAgICAgICAgICAjcGFsZXNuaXBlLWRvbmF0aW9uLXVpID4gaDMsICNwYWxlc25pcGUtZG9uYXRpb24tdWkgPiBkaXYgeyBkaXNwbGF5OiBpbmxpbmUgfQ0KICAgICAgICAgICAgI3BhbGVzbmlwZS1kb25hdGlvbi11aSA+IGRpdjpiZWZvcmUgeyBjb250ZW50OiAnfCc7IG1hcmdpbi1yaWdodDogOHB4OyB9DQogICAgICAgICAgICAjcGFsZXNuaXBlLWRvbmF0aW9uLXVpIGEgeyBjb2xvcjogd2hpdGU7IH0NCiAgICAgICAgICAgIC5wYWxlc25pcGUtc2V0dGluZ3Mtd3JhcHBlciBpbnB1dCB7IHdpZHRoOiAxNTBweDsgbWFyZ2luLWxlZnQ6IDhweDsgZGlzcGxheTogdGFibGUtY2VsbDsgbWFyZ2luLWJvdHRvbTogMnB4OyB9DQogICAgICAgICAgICAucGFsZXNuaXBlLXNldHRpbmdzLXdyYXBwZXIgPiBkaXYgeyBkaXNwbGF5OiB0YWJsZTsgZmxvYXQ6IGxlZnQ7IG1hcmdpbi1sZWZ0OiA4cHg7IH0NCiAgICAgICAgICAgIC5wYWxlc25pcGUtc2V0dGluZ3Mtd3JhcHBlciA+IGRpdiA+IGRpdiB7IGRpc3BsYXk6IHRhYmxlLXJvdzsgfQ0KICAgICAgICAgICAgLnBhbGVzbmlwZS1zZXR0aW5ncy13cmFwcGVyID4gZGl2ID4gZGl2ID4gbGFiZWwgeyBkaXNwbGF5OiB0YWJsZS1jZWxsOyB9DQogICAgICAgICAgICAucGFsZXNuaXBlLXNldHRpbmdzLXdyYXBwZXIgPiBkaXY6bnRoLWNoaWxkKDQpIHsgY2xlYXI6bGVmdDt9DQogICAgICAgICAgICAucGFsZXNuaXBlLXNldHRpbmdzLXdyYXBwZXIgLnV0LXRvZ2dsZS1jb250cm9sIHsgd2lkdGg6IDMwcHg7IGZsb2F0OnJpZ2h0OyB9DQogICAgICAgICAgICAucGFsZXNuaXBlLXNldHRpbmdzLXdyYXBwZXIgPiBkaXYgPiBkaXYgeyBsaW5lLWhlaWdodDogNDBweDt9DQogICAgICAgICAgICBgOw0KDQogICAgICAgIF9hcHBTdHlsZXMuaW5uZXJUZXh0ID0gY3NzOw0KICAgIH07DQoNCiAgICBmdW5jdGlvbiByZXNldENzcygpIHsNCiAgICAgICAgYWRkQ3NzKF9wYWxlc25pcGVTZXR0aW5ncy5idXR0b25zKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhZGREb25hdGlvblVJKCkgew0KICAgICAgICAkKCIudXQtZmlmYS1oZWFkZXItdmlldyIpLmFwcGVuZChgPGRpdiBpZD0icGFsZXNuaXBlLWRvbmF0aW9uLXVpIiBjbGFzcz0icGFsZXNuaXBlLWVsZW1lbnQiPg0KICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGl0bGUiPiR7VkVSU0lPTn0gLSBQb3dlcmVkIGJ5IFBhbGV0b29sczwvaDM+DQogICAgICAgICAgICAgICAgPGRpdj48YSBocmVmPSJodHRwczovL3N0cmVhbWxhYnMuY29tL3BhbGV0YV9hci90aXAiIHRhcmdldD0iX2JsYW5rIj5QYXlQYWwgRG9uYXRpb248L2E+PC9kaXY+DQogICAgICAgICAgICAgICAgPGRpdj48YSBocmVmPSJodHRwczovL2NlbmVrYS5uZXQvbXAvZC9wYWxldGFlYWEiIHRhcmdldD0iX2JsYW5rIj5NZXJjYWRvUGFnbyBEb25hdGlvbjwvYT48L2Rpdj4NCiAgICAgICAgICAgICAgICA8ZGl2PkZvbGxvdyBtZSBhdCZuYnNwOzxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20vcGFsZXRhIiB0YXJnZXQ9Il9ibGFuayI+QHBhbGV0YTwvYT48L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2PmApOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGVuYWJsZURpc2FibGVBcHAoKSB7DQogICAgICAgIGlmIChfZW5hYmxlZCkgew0KICAgICAgICAgICAgZGlzYWJsZUFwcCgpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgZW5hYmxlQXBwKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBub3RpZnlTdWNjZXNzKG1zZyl7DQogICAgICAgIHNlcnZpY2VzLk5vdGlmaWNhdGlvbi5xdWV1ZShbbXNnLCBVSU5vdGlmaWNhdGlvblR5cGUuUE9TSVRJVkVdKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBub3RpZnlOZXV0cmFsKG1zZyl7DQogICAgICAgIHNlcnZpY2VzLk5vdGlmaWNhdGlvbi5xdWV1ZShbbXNnLCBVSU5vdGlmaWNhdGlvblR5cGUuTkVVVFJBTF0pDQogICAgfQ0KDQogICAgZnVuY3Rpb24gZW5hYmxlQXBwKCkgew0KICAgICAgICBfZW5hYmxlZCA9IHRydWU7DQogICAgICAgIHJlc2V0Q3NzKCk7DQogICAgICAgIG5vdGlmeVN1Y2Nlc3MoIlBhbGVzbmlwZSBFbmFibGVkIik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGlzYWJsZUFwcCgpIHsNCiAgICAgICAgX2VuYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgX2FwcFN0eWxlcy5pbm5lclRleHQgPSAiLnBhbGVzbmlwZS1lbGVtZW50IHsgZGlzcGxheTogbm9uZTsgfSI7DQogICAgICAgIG5vdGlmeU5ldXRyYWwoIlBhbGVzbmlwZSBEaXNhYmxlZCIpOw0KICAgIH0NCg0KICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGUgPT4gew0KICAgICAgICBsZXQgcCA9IF9wYWxlc25pcGVTZXR0aW5ncy5idXR0b25zOw0KICAgICAgICBpZiAoZS5jb2RlID09IHAuZW5hYmxlRGlzYWJsZSkgew0KICAgICAgICAgICAgZW5hYmxlRGlzYWJsZUFwcCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFfZW5hYmxlZCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IGFjdGlvbiA9IGtleXMocClbZS5jb2RlXTsNCiAgICAgICAgaWYgKGFjdGlvbikgYWN0aW9uKCk7DQogICAgfSk7DQoNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKF9hcHBTdHlsZXMpOw0KICAgIGVuYWJsZUFwcCgpOw0KICAgIGFkZERvbmF0aW9uVUkoKTsNCiAgICBnZXRBcHBNYWluKCkuZ2V0Um9vdFZpZXdDb250cm9sbGVyKCkuc2hvd0dhbWVWaWV3KCk7DQp9KSgvKkJVVFRPTlMqLyk7"