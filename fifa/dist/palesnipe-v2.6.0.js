window.paletools = window.paletools || {};
window.paletools['palesnipe-2.6.0'] = "KGZ1bmN0aW9uIChidXR0b25zKSB7DQogICAgY29uc3QgVkVSU0lPTiA9ICJ2Mi42LjAiOw0KDQogICAgYnV0dG9ucyA9ICQuZXh0ZW5kKHsNCiAgICAgICAgYmFjazogJ0RpZ2l0MScsDQogICAgICAgIGVuYWJsZURpc2FibGU6ICdDb21tYScsDQogICAgICAgIGxpc3RzOiB7DQogICAgICAgICAgICB1cDogJ0Fycm93VXAnLA0KICAgICAgICAgICAgZG93bjogJ0Fycm93RG93bicsDQogICAgICAgICAgICBwcmV2OiAnQXJyb3dMZWZ0JywNCiAgICAgICAgICAgIG5leHQ6ICdBcnJvd1JpZ2h0JywNCiAgICAgICAgfSwNCiAgICAgICAgc2VhcmNoOiB7DQogICAgICAgICAgICByZXNldEJpZDogJ0JhY2txdW90ZScsDQogICAgICAgICAgICBkZWNNaW5CaWQ6ICdBcnJvd0xlZnQnLA0KICAgICAgICAgICAgaW5jTWluQmlkOiAnQXJyb3dSaWdodCcsDQogICAgICAgICAgICBkZWNNYXhCaWQ6ICdFbmQnLA0KICAgICAgICAgICAgaW5jTWF4QmlkOiAnSG9tZScsDQogICAgICAgICAgICBkZWNNaW5CdXk6ICdEZWxldGUnLA0KICAgICAgICAgICAgaW5jTWluQnV5OiAnUGFnZURvd24nLA0KICAgICAgICAgICAgZGVjTWF4QnV5OiAnQXJyb3dEb3duJywNCiAgICAgICAgICAgIGluY01heEJ1eTogJ0Fycm93VXAnLA0KICAgICAgICAgICAgc2VhcmNoOiAnRGlnaXQyJywNCiAgICAgICAgICAgIGJvdE1vZGVNaW5CaWQ6ICdCcmFja2V0UmlnaHQnLA0KICAgICAgICAgICAgYm90TW9kZU1pbkJ1eTogJ0JyYWNrZXRMZWZ0JywNCiAgICAgICAgICAgIGVuYWJsZUJvdE1vZGU6IGZhbHNlDQogICAgICAgIH0sDQogICAgICAgIHJlc3VsdHM6IHsNCiAgICAgICAgICAgIGJpZDogJ0RpZ2l0NCcsDQogICAgICAgICAgICBidXk6ICdEaWdpdDMnLA0KICAgICAgICAgICAgdHJhbnNmZXI6ICdLZXlSJywNCiAgICAgICAgICAgIGNsdWI6ICdLZXlDJywNCiAgICAgICAgICAgIHByZXNzRW50ZXI6IHRydWUsDQogICAgICAgICAgICBhdXRvQnV5OiBmYWxzZSwNCiAgICAgICAgICAgIHByZXZlbnRCYWNrOiBmYWxzZSwNCiAgICAgICAgICAgIHNlbGw6ICdLZXlRJywNCiAgICAgICAgICAgIGRlY0JpZDogJ0RlbGV0ZScsDQogICAgICAgICAgICBpbmNCaWQ6ICdQYWdlRG93bicNCiAgICAgICAgfQ0KICAgIH0sIGJ1dHRvbnMgfHwge30pOw0KICAgIGxldCBwID0gYnV0dG9uczsNCiAgICBsZXQgZW5hYmxlZCA9IHRydWU7DQogICAgbGV0IGFwcFN0eWxlcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7DQoNCiAgICAvLyByZXNldCBjb25zb2xlDQogICAgbGV0IGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOw0KICAgIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaWZyYW1lKTsNCiAgICB3aW5kb3cuY29uc29sZSA9IGlmcmFtZS5jb250ZW50V2luZG93LmNvbnNvbGU7DQoNCiAgICB3aW5kb3cuTUFYX05FV19JVEVNUyA9IE51bWJlci5NQVhfVkFMVUU7DQoNCiAgICBsZXQgX3NlbGVjdGVkUmF0aW5nID0gIiI7DQoNCiAgICBjb25zdCBnZXRDdXJyZW50Q29udHJvbGxlciA9ICgpID0+IGdldEFwcE1haW4oKS5nZXRSb290Vmlld0NvbnRyb2xsZXIoKS5nZXRQcmVzZW50ZWRWaWV3Q29udHJvbGxlcigpLmdldEN1cnJlbnRWaWV3Q29udHJvbGxlcigpLmdldEN1cnJlbnRDb250cm9sbGVyKCk7DQoNCiAgIC8vICQoIi51dC1maWZhLWhlYWRlci12aWV3IikuYXBwZW5kKGA8YnV0dG9uIGlkPSJ0aHJvdyI+REVCVUc8L2J1dHRvbj5gKTsNCg0KICAgICQoIiN0aHJvdyIpLmNsaWNrKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJkZWJ1ZyBlcnJvciIpOw0KICAgIH0pOw0KDQogICAgY29uc3QgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld19fZ2VuZXJhdGUgPSBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5fZ2VuZXJhdGUNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5fZ2VuZXJhdGUgPSBmdW5jdGlvbiBfZ2VuZXJhdGUoKSB7DQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW5lcihjaGlsZCkgew0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgiaW5saW5lLWxpc3Qtc2VsZWN0Iik7DQogICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgidXQtcGxheWVyLXNlYXJjaC1jb250cm9sIik7DQogICAgICAgICAgICBjb25zdCBpbmxpbmVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQ0KICAgICAgICAgICAgaW5saW5lQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImlubGluZS1jb250YWluZXIiKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpbmxpbmVDb250YWluZXIpOw0KICAgICAgICAgICAgY29uc3QgaW5saW5lSW5saW5lQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBpbmxpbmVDb250YWluZXIuYXBwZW5kQ2hpbGQoaW5saW5lSW5saW5lQ29udGFpbmVyKTsNCiAgICAgICAgICAgIGlubGluZUlubGluZUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJ1dC1wbGF5ZXItc2VhcmNoLWNvbnRyb2wtLWlucHV0LWNvbnRhaW5lciIpOw0KICAgICAgICAgICAgaW5saW5lSW5saW5lQ29udGFpbmVyLmFwcGVuZENoaWxkKGNoaWxkKTsNCiAgICAgICAgICAgIHJldHVybiBjb250YWluZXI7DQogICAgICAgIH0NCg0KICAgICAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3X19nZW5lcmF0ZS5jYWxsKHRoaXMpOw0KICAgICAgICBpZiAoIXRoaXMuX2dlbmVyYXRlUGFsZXNuaXBlQ2FsbGVkKSB7DQogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJ1dC1pdGVtLXNlYXJjaC12aWV3Iik7DQogICAgICAgICAgICB0aGlzLl9wbGF5ZXJJZCA9IG5ldyBVVFRleHRJbnB1dENvbnRyb2woKTsNCiAgICAgICAgICAgIGNvbnN0IHBsYXllcklkQ29udGFpbmVyID0gY3JlYXRlQ29udGFpbmVyKHRoaXMuX3BsYXllcklkLmdldFJvb3RFbGVtZW50KCkpOw0KDQogICAgICAgICAgICB0aGlzLl9wbGF5ZXJSYXRpbmcgPSBuZXcgVVRUZXh0SW5wdXRDb250cm9sKCk7DQogICAgICAgICAgICBjb25zdCBwbGF5ZXJSYXRpbmdDb250YWluZXIgPSBjcmVhdGVDb250YWluZXIodGhpcy5fcGxheWVyUmF0aW5nLmdldFJvb3RFbGVtZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZmlsdGVyc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KDQogICAgICAgICAgICB0aGlzLl9maWx0ZXJOYW1lID0gbmV3IFVUVGV4dElucHV0Q29udHJvbCgpOw0KICAgICAgICAgICAgdGhpcy5fZmlsdGVyTmFtZS5pbml0KCk7DQoNCiAgICAgICAgICAgIHRoaXMuX3NhdmVGaWx0ZXJCdXR0b24gPSBuZXcgVVRTdGFuZGFyZEJ1dHRvbkNvbnRyb2woKTsNCiAgICAgICAgICAgIHRoaXMuX3NhdmVGaWx0ZXJCdXR0b24uaW5pdCgpOw0KICAgICAgICAgICAgdGhpcy5fc2F2ZUZpbHRlckJ1dHRvbi5zZXRUZXh0KCJTYXZlIik7DQogICAgICAgICAgICB0aGlzLl9zYXZlRmlsdGVyQnV0dG9uLmFkZFRhcmdldCh0aGlzLCB0aGlzLnNhdmVGaWx0ZXIsIEV2ZW50VHlwZS5UQVApOw0KDQogICAgICAgICAgICB0aGlzLl9kZWxldGVGaWx0ZXJCdXR0b24gPSBuZXcgVVRTdGFuZGFyZEJ1dHRvbkNvbnRyb2woKTsNCiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbHRlckJ1dHRvbi5pbml0KCk7DQogICAgICAgICAgICB0aGlzLl9kZWxldGVGaWx0ZXJCdXR0b24uc2V0VGV4dCgiRGVsZXRlIik7DQogICAgICAgICAgICB0aGlzLl9kZWxldGVGaWx0ZXJCdXR0b24uYWRkVGFyZ2V0KHRoaXMsIHRoaXMuZGVsZXRlRmlsdGVyLCBFdmVudFR5cGUuVEFQKTsNCg0KICAgICAgICAgICAgdGhpcy5fc2F2ZWRGaWx0ZXJzID0gbmV3IFVURHJvcERvd25Db250cm9sKCk7DQogICAgICAgICAgICB0aGlzLl9zYXZlZEZpbHRlcnMuaW5pdCgpOw0KICAgICAgICAgICAgdGhpcy5fc2F2ZWRGaWx0ZXJzLmFkZFRhcmdldCh0aGlzLCB0aGlzLm9uU2F2ZWRGaWx0ZXJzQ2hhbmdlLCBFdmVudFR5cGUuQ0hBTkdFKTsNCg0KICAgICAgICAgICAgJChmaWx0ZXJzQ29udGFpbmVyKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmQodGhpcy5fZmlsdGVyTmFtZS5nZXRSb290RWxlbWVudCgpKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmQodGhpcy5fc2F2ZUZpbHRlckJ1dHRvbi5nZXRSb290RWxlbWVudCgpKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmQodGhpcy5fZGVsZXRlRmlsdGVyQnV0dG9uLmdldFJvb3RFbGVtZW50KCkpDQogICAgICAgICAgICAgICAgLmFwcGVuZCh0aGlzLl9zYXZlZEZpbHRlcnMuZ2V0Um9vdEVsZW1lbnQoKSk7DQoNCiAgICAgICAgICAgICQoY29udGFpbmVyKQ0KICAgICAgICAgICAgICAgIC8vLmFwcGVuZChmaWx0ZXJzQ29udGFpbmVyKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmQocGxheWVySWRDb250YWluZXIpLmFwcGVuZChwbGF5ZXJSYXRpbmdDb250YWluZXIpOw0KICAgICAgICAgICAgJChjb250YWluZXIpLmluc2VydEJlZm9yZSgkKCIudXQtaXRlbS1zZWFyY2gtdmlldyIsIHRoaXMuX19yb290KSk7DQoNCiAgICAgICAgICAgIHRoaXMuX3BsYXllcklkLmluaXQoKTsNCiAgICAgICAgICAgIHRoaXMuX3BsYXllcklkLnNldFBsYWNlaG9sZGVyKCJQbGF5ZXIgSUQiKTsNCiAgICAgICAgICAgIHRoaXMuX3BsYXllcklkLnNldE1heExlbmd0aCgyNSk7DQogICAgICAgICAgICB0aGlzLl9wbGF5ZXJJZC5hZGRUYXJnZXQodGhpcywgdGhpcy5oYW5kbGVQbGF5ZXJJZENoYW5nZSwgRXZlbnRUeXBlLkNIQU5HRSk7DQogICAgICAgICAgICB0aGlzLl9wbGF5ZXJSYXRpbmcuaW5pdCgpOw0KICAgICAgICAgICAgdGhpcy5fcGxheWVyUmF0aW5nLnNldFBsYWNlaG9sZGVyKCJQbGF5ZXIgUmF0aW5nIik7DQogICAgICAgICAgICB0aGlzLl9wbGF5ZXJSYXRpbmcuc2V0TWF4TGVuZ3RoKDMpOw0KICAgICAgICAgICAgdGhpcy5fcGxheWVyUmF0aW5nLmFkZFRhcmdldCh0aGlzLCB0aGlzLmhhbmRsZVBsYXllclJhdGluZ0NoYW5nZSwgRXZlbnRUeXBlLkNIQU5HRSk7DQoNCiAgICAgICAgICAgIHRoaXMubG9hZFNhdmVkRmlsdGVycygpOw0KDQogICAgICAgICAgICB0aGlzLl9nZW5lcmF0ZVBhbGVzbmlwZUNhbGxlZCA9IHRydWU7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5nZXRTdG9yZWRGaWx0ZXJzID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBjb25zdCBkYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oInBhbGV0b29sczpzZWFyY2hGaWx0ZXJzIik7DQogICAgICAgIGlmICghZGF0YSkgcmV0dXJuIHt9Ow0KICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShhdG9iKGRhdGEpKSB8fCB7fTsNCiAgICB9DQoNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5zYXZlRmlsdGVycyA9IGZ1bmN0aW9uIChmaWx0ZXJzKSB7DQogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJwYWxldG9vbHM6c2VhcmNoRmlsdGVycyIsIGJ0b2EoSlNPTi5zdHJpbmdpZnkoZmlsdGVycykpKTsNCiAgICB9DQoNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5sb2FkU2F2ZWRGaWx0ZXJzID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBjb25zdCBzZWFyY2hGaWx0ZXJzID0gdGhpcy5nZXRTdG9yZWRGaWx0ZXJzKCk7DQogICAgICAgIGxldCBmaWx0ZXJzID0gW3sgbGFiZWw6ICcnLCB2YWx1ZTogJycgfV07DQogICAgICAgIGZvciAobGV0IGZpbHRlcktleSBvZiBPYmplY3Qua2V5cyhzZWFyY2hGaWx0ZXJzKS5zb3J0KCkpIHsNCiAgICAgICAgICAgIGZpbHRlcnMucHVzaCh7IGxhYmVsOiBzZWFyY2hGaWx0ZXJzW2ZpbHRlcktleV0ubmFtZSwgdmFsdWU6IGZpbHRlcktleSB9KTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLl9zYXZlZEZpbHRlcnMuc2V0T3B0aW9ucyhmaWx0ZXJzKTsNCiAgICB9DQoNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5zYXZlRmlsdGVyID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBjb25zdCBjb250cm9sbGVyID0gZ2V0Q3VycmVudENvbnRyb2xsZXIoKTsNCiAgICAgICAgaWYgKGNvbnRyb2xsZXIgaW5zdGFuY2VvZiBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3Q29udHJvbGxlcikgew0KICAgICAgICAgICAgY29uc3Qgc2VhcmNoQ3JpdGVyaWEgPSBjb250cm9sbGVyLl92aWV3bW9kZWwuc2VhcmNoQ3JpdGVyaWE7DQogICAgICAgICAgICBjb25zdCBuYW1lID0gdGhpcy5fZmlsdGVyTmFtZS5nZXRWYWx1ZSgpOw0KICAgICAgICAgICAgY29uc3Qga2V5ID0gbmFtZS5yZXBsYWNlKC9bXmEtejAtOV0vZ2ksICdfJykudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgIGNvbnN0IGZpbHRlcnMgPSB0aGlzLmdldFN0b3JlZEZpbHRlcnMoKTsNCiAgICAgICAgICAgIHNlYXJjaENyaXRlcmlhLnJhdGluZyA9IHRoaXMuX3BsYXllclJhdGluZy5nZXRWYWx1ZSgpOw0KICAgICAgICAgICAgZmlsdGVyc1trZXldID0geyBuYW1lOiBuYW1lLCBjcml0ZXJpYTogc2VhcmNoQ3JpdGVyaWEgfTsNCiAgICAgICAgICAgIHRoaXMuc2F2ZUZpbHRlcnMoZmlsdGVycyk7DQogICAgICAgICAgICB0aGlzLmxvYWRTYXZlZEZpbHRlcnMoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXcucHJvdG90eXBlLmRlbGV0ZUZpbHRlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY29uc3QgY29udHJvbGxlciA9IGdldEN1cnJlbnRDb250cm9sbGVyKCk7DQogICAgICAgIGlmIChjb250cm9sbGVyIGluc3RhbmNlb2YgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXIpIHsNCiAgICAgICAgICAgIGNvbnN0IGZpbHRlcktleSA9IHRoaXMuX3NhdmVkRmlsdGVycy5nZXRWYWx1ZSgpOw0KICAgICAgICAgICAgaWYgKCFmaWx0ZXJLZXkpIHJldHVybjsNCiAgICAgICAgICAgIGNvbnN0IGZpbHRlcnMgPSB0aGlzLmdldFN0b3JlZEZpbHRlcnMoKTsNCiAgICAgICAgICAgIGRlbGV0ZSBmaWx0ZXJzW2ZpbHRlcktleV07DQogICAgICAgICAgICB0aGlzLnNhdmVGaWx0ZXJzKGZpbHRlcnMpOw0KICAgICAgICAgICAgdGhpcy5sb2FkU2F2ZWRGaWx0ZXJzKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5sb2FkRmlsdGVyID0gZnVuY3Rpb24gKGZpbHRlcikgew0KICAgICAgICBjb25zdCBjb250cm9sbGVyID0gZ2V0Q3VycmVudENvbnRyb2xsZXIoKTsNCiAgICAgICAgaWYgKGNvbnRyb2xsZXIgaW5zdGFuY2VvZiBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3Q29udHJvbGxlcikgew0KICAgICAgICAgICAgdGhpcy5fcGxheWVyUmF0aW5nLnNldFZhbHVlKGZpbHRlci5jcml0ZXJpYS5yYXRpbmcpOw0KICAgICAgICAgICAgZm9yIChsZXQga2V5IG9mIE9iamVjdC5rZXlzKGZpbHRlci5jcml0ZXJpYSkpIHsNCiAgICAgICAgICAgICAgICBjb250cm9sbGVyLl92aWV3bW9kZWwuc2VhcmNoQ3JpdGVyaWFba2V5XSA9IGZpbHRlci5jcml0ZXJpYVtrZXldOw0KICAgICAgICAgICAgICAgIHRoaXMuc2V0RmlsdGVycyhjb250cm9sbGVyLl92aWV3bW9kZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgY29uc3QgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld19kZXN0cm95R2VuZXJhdGVkRWxlbWVudHMgPSBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5kZXN0cm95R2VuZXJhdGVkRWxlbWVudHM7DQogICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlldy5wcm90b3R5cGUuZGVzdHJveUdlbmVyYXRlZEVsZW1lbnRzID0gZnVuY3Rpb24gZGVzdHJveUdlbmVyYXRlZEVsZW1lbnRzKCkgew0KICAgICAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3X2Rlc3Ryb3lHZW5lcmF0ZWRFbGVtZW50cy5jYWxsKHRoaXMpOw0KICAgICAgICB0aGlzLl9wbGF5ZXJJZC5kZXN0cm95KCk7DQogICAgICAgIHRoaXMuX3BsYXllclJhdGluZy5kZXN0cm95KCk7DQogICAgICAgIHRoaXMuX2ZpbHRlck5hbWUuZGVzdHJveSgpOw0KICAgICAgICB0aGlzLl9zYXZlRmlsdGVyQnV0dG9uLmRlc3Ryb3koKTsNCiAgICAgICAgdGhpcy5fZGVsZXRlRmlsdGVyQnV0dG9uLmRlc3Ryb3koKTsNCiAgICAgICAgdGhpcy5fc2F2ZWRGaWx0ZXJzLmRlc3Ryb3koKTsNCiAgICB9DQoNCiAgICBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3LnByb3RvdHlwZS5oYW5kbGVQbGF5ZXJJZENoYW5nZSA9IGZ1bmN0aW9uIChfLCBfXywgZWxlbSkgew0KICAgICAgICBjb25zdCBjb250cm9sbGVyID0gZ2V0Q3VycmVudENvbnRyb2xsZXIoKTsNCiAgICAgICAgaWYgKGNvbnRyb2xsZXIgaW5zdGFuY2VvZiBVVE1hcmtldFNlYXJjaEZpbHRlcnNWaWV3Q29udHJvbGxlcikgew0KICAgICAgICAgICAgY29udHJvbGxlci5fdmlld21vZGVsLnNlYXJjaENyaXRlcmlhLmRlZklkID0gW2VsZW0udmFsdWVdOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlldy5wcm90b3R5cGUuaGFuZGxlUGxheWVyUmF0aW5nQ2hhbmdlID0gZnVuY3Rpb24gKF8sIF9fLCBlbGVtKSB7DQogICAgICAgIF9zZWxlY3RlZFJhdGluZyA9IGVsZW0udmFsdWU7DQogICAgfQ0KDQogICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlldy5wcm90b3R5cGUub25TYXZlZEZpbHRlcnNDaGFuZ2UgPSBmdW5jdGlvbiAoXywgX18sIGVsZW0pIHsNCiAgICAgICAgY29uc3QgZmlsdGVycyA9IHRoaXMuZ2V0U3RvcmVkRmlsdGVycygpOw0KICAgICAgICBpZiAoZmlsdGVyc1tlbGVtLnZhbHVlXSkgew0KICAgICAgICAgICAgdGhpcy5sb2FkRmlsdGVyKGZpbHRlcnNbZWxlbS52YWx1ZV0pOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgY29udHJvbGxlciA9IGdldEN1cnJlbnRDb250cm9sbGVyKCk7DQogICAgICAgICAgICBpZiAoY29udHJvbGxlciBpbnN0YW5jZW9mIFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdDb250cm9sbGVyKSB7DQogICAgICAgICAgICAgICAgY29udHJvbGxlci5fZVJlc2V0U2VsZWN0ZWQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGNvbnN0IFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdDb250cm9sbGVyX19lUmVzZXRTZWxlY3RlZCA9IFVUTWFya2V0U2VhcmNoRmlsdGVyc1ZpZXdDb250cm9sbGVyLnByb3RvdHlwZS5fZVJlc2V0U2VsZWN0ZWQ7DQogICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXIucHJvdG90eXBlLl9lUmVzZXRTZWxlY3RlZCA9IGZ1bmN0aW9uIF9lUmVzZXRTZWxlY3RlZCgpIHsNCiAgICAgICAgdGhpcy5nZXRWaWV3KCkuX3BsYXllcklkLmNsZWFyKCk7DQogICAgICAgIHRoaXMuZ2V0VmlldygpLl9wbGF5ZXJSYXRpbmcuY2xlYXIoKTsNCiAgICAgICAgVVRNYXJrZXRTZWFyY2hGaWx0ZXJzVmlld0NvbnRyb2xsZXJfX2VSZXNldFNlbGVjdGVkLmNhbGwodGhpcyk7DQogICAgfQ0KDQoNCiAgICBVVFBhZ2luYXRlZEl0ZW1MaXN0Vmlldy5wcm90b3R5cGUuc2V0SXRlbXMgPSBmdW5jdGlvbiAoZSwgaSkgew0KICAgICAgICB2YXIgbyA9IHRoaXM7DQogICAgICAgIHJldHVybiB0aGlzLnJlbW92ZUxpc3RSb3dzKCksDQogICAgICAgICAgICBlLmZvckVhY2goZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkUmVuZGVySXRlbShlKSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IG5ldyBVVEl0ZW1UYWJsZUNlbGxWaWV3Ow0KICAgICAgICAgICAgICAgICAgICB0LnNldERhdGEoZSwgdm9pZCAwLCB2b2lkIDAsIGkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgby5saXN0Um93cy5wdXNoKHQpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSksDQogICAgICAgICAgICB0aGlzLmxpc3RSb3dzDQogICAgfQ0KDQogICAgVVRJdGVtVGFibGVDZWxsVmlldy5wcm90b3R5cGUuX29sZFJlbmRlciA9IFVUSXRlbVRhYmxlQ2VsbFZpZXcucHJvdG90eXBlLnJlbmRlcjsNCiAgICBVVEl0ZW1UYWJsZUNlbGxWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZSkgew0KICAgICAgICB0aGlzLl9vbGRSZW5kZXIoKTsNCiAgICAgICAgaWYgKHRoaXMuZGF0YS5pc1BsYXllcigpKSB7DQogICAgICAgICAgICAkKCIudXQtaXRlbS12aWV3LS1tYWluIiwgdGhpcy5fX2VudGl0eUNvbnRhaW5lcikuYXBwZW5kKGA8c3BhbiBjbGFzcz0icGxheWVyLWRlZmluaXRpb24taWQiPiR7dGhpcy5kYXRhLmRlZmluaXRpb25JZH08L3NwYW4+YCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzaG91bGRSZW5kZXJJdGVtKGl0ZW0pIHsNCiAgICAgICAgbGV0IHJhdGluZyA9IF9zZWxlY3RlZFJhdGluZzsNCg0KICAgICAgICBpZiAoIXJhdGluZykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAocmF0aW5nLmNoYXJBdCgwKSA9PT0gIisiKSB7DQogICAgICAgICAgICAgICAgcmF0aW5nID0gcGFyc2VJbnQocmF0aW5nLnN1YnN0cigxKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ucmF0aW5nID49IHJhdGluZzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHJhdGluZy5jaGFyQXQoMCkgPT09ICItIikgew0KICAgICAgICAgICAgICAgIHJhdGluZyA9IHBhcnNlSW50KHJhdGluZy5zdWJzdHIoMSkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnJhdGluZyA8PSByYXRpbmc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByYXRpbmcgPSBwYXJzZUludChyYXRpbmcpOw0KICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnJhdGluZyA9PSByYXRpbmc7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBVVEl0ZW1Eb21haW5SZXBvc2l0b3J5LnByb3RvdHlwZS5pc1BpbGVGdWxsID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgdmFyIHQgPSAwDQogICAgICAgICAgICAsIGkgPSB0aGlzLnBpbGVTaXplcy5nZXQoZSk7DQogICAgICAgIHN3aXRjaCAoZSkgew0KICAgICAgICAgICAgY2FzZSBJdGVtUGlsZS5QVVJDSEFTRUQ6DQogICAgICAgICAgICAgICAgdCA9IHRoaXMudW5hc3NpZ25lZC5sZW5ndGg7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIEl0ZW1QaWxlLlRSQU5TRkVSOg0KICAgICAgICAgICAgICAgIHQgPSB0aGlzLnRyYW5zZmVyLmxlbmd0aDsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgSXRlbVBpbGUuSU5CT1g6DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICBjYXNlIEl0ZW1QaWxlLkNMVUI6DQogICAgICAgICAgICAgICAgcmV0dXJuICExDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIChpIHx8IDApIDw9IHQNCiAgICB9DQoNCiAgICBjb25zdA0KICAgICAgICBsID0gY29uc29sZS5sb2csDQogICAgICAgIGxvYyA9IHdpbmRvdy5zZXJ2aWNlcy5Mb2NhbGl6YXRpb24sDQogICAgICAgIGRpc3BhdGNoTW91c2VFdmVudCA9ICgkdGFyZ2V0LCBldmVudE5hbWUpID0+IHsNCiAgICAgICAgICAgIGlmICgkdGFyZ2V0Lmxlbmd0aCA9PSAwKSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICBjb25zdCBtb3VzZUV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyk7DQogICAgICAgICAgICBtb3VzZUV2ZW50LmluaXRFdmVudChldmVudE5hbWUpOw0KICAgICAgICAgICAgJHRhcmdldFswXS5kaXNwYXRjaEV2ZW50KG1vdXNlRXZlbnQpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0sDQogICAgICAgIG1vdXNlRG93biA9IHRhcmdldCA9PiBkaXNwYXRjaE1vdXNlRXZlbnQodGFyZ2V0LCAnbW91c2Vkb3duJyksDQogICAgICAgIG1vdXNlVXAgPSB0YXJnZXQgPT4gZGlzcGF0Y2hNb3VzZUV2ZW50KHRhcmdldCwgJ21vdXNldXAnKSwNCiAgICAgICAgbW91c2VDbGljayA9ICh0YXJnZXQsIGRlbGF5LCBjYWxsYmFjaykgPT4gew0KICAgICAgICAgICAgaWYgKGRlbGF5KSB7DQogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG1vdXNlQ2xpY2sodGFyZ2V0KSk7DQogICAgICAgICAgICAgICAgfSwgZGVsYXkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG1vdXNlRG93bih0YXJnZXQpICYmIG1vdXNlVXAodGFyZ2V0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgYnV5Tm93ID0gKGNhbGxiYWNrKSA9PiB7DQogICAgICAgICAgICBpZiAobW91c2VDbGljayhidXlCdG4oKSkpIHsNCiAgICAgICAgICAgICAgICBpZiAocC5yZXN1bHRzLnByZXNzRW50ZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5UHJlc3NPa0J0bihjYWxsYmFjayk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB0cnlQcmVzc09rQnRuID0gKGNhbGxiYWNrKSA9PiB7DQogICAgICAgICAgICBpZiAoIW1vdXNlQ2xpY2soZW50ZXJCdG4oKSkpIHsNCiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChjYWxsYmFjayhmYWxzZSksIDApOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQodHJ5UHJlc3NPa0J0biwgMTApOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgew0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0cnVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdXBkYXRlQm91Z2h0VUkoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgYmFjayA9ICgpID0+IHsNCiAgICAgICAgICAgIGwoJ2JhY2snKTsNCiAgICAgICAgICAgIGlmICghbW91c2VDbGljayhiYWNrQnRuKCkpKSB7DQogICAgICAgICAgICAgICAgc2V0VGltZW91dChiYWNrLCAxKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICBzZWFyY2ggPSAoKSA9PiB7DQogICAgICAgICAgICBtb3VzZUNsaWNrKHNlYXJjaEJ0bigpKTsNCiAgICAgICAgICAgIGlmIChwLnJlc3VsdHMuYXV0b0J1eSkgew0KICAgICAgICAgICAgICAgIGlmIChzZWFyY2hSZXN1bHRzKCkgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBsKCdyZXNlYXJjaGluZycpOw0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHNlYXJjaCwgMTApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbCgkKCIudXQtbm8tcmVzdWx0cy12aWV3IikubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCQoIi51dC1uby1yZXN1bHRzLXZpZXciKS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsKCdubyByZXN1bHRzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBiYWNrKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsKCdidXlpbmcnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1eU5vdygoYm91Z2h0KSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJvdWdodCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VzZUNsaWNrKHRyYW5zZmVyQnRuKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIHRyYW5zZmVyQnRuID0gKCkgPT4gJChgLnV0LWJ1dHRvbi1ncm91cCA+IGJ1dHRvbjpjb250YWlucygnJHtsb2MubG9jYWxpemUoJ2luZm9wYW5lbC5sYWJlbC5zZW5kVHJhZGVQaWxlJyl9JylgKSwNCiAgICAgICAgY2x1YkJ0biA9ICgpID0+ICQoYC51dC1idXR0b24tZ3JvdXAgPiBidXR0b246Y29udGFpbnMoJyR7bG9jLmxvY2FsaXplKCdpbmZvcGFuZWwubGFiZWwuc3RvcmVJbkNsdWInKX0nKWApLA0KICAgICAgICBzZWxsQnRuID0gKCkgPT4gJChgLnV0LWJ1dHRvbi1ncm91cCA+IGJ1dHRvbjpjb250YWlucygnJHtsb2MubG9jYWxpemUoJ2luZm9wYW5lbC5sYWJlbC5kaXNjYXJkJyl9JylgKSwNCiAgICAgICAgYnV5QnRuID0gKCkgPT4gJCgnLmJ1eUJ1dHRvbicpLA0KICAgICAgICBiYWNrQnRuID0gKCkgPT4gJCgnLnV0LW5hdmlnYXRpb24tYnV0dG9uLWNvbnRyb2wnKSwNCiAgICAgICAgZW50ZXJCdG4gPSAoKSA9PiAkKCcuZWEtZGlhbG9nLXZpZXcgLnV0LWJ1dHRvbi1ncm91cCBidXR0b246ZXEoMCknKSwNCiAgICAgICAgc2VhcmNoQnRuID0gKCkgPT4gJCgnLmJ1dHRvbi1jb250YWluZXIgLmJ0bi1zdGFuZGFyZC5jYWxsLXRvLWFjdGlvbicpLA0KICAgICAgICBzZWFyY2hSZXN1bHRzID0gKCkgPT4gJCgnLlNlYXJjaFJlc3VsdHMnKS5sZW5ndGgsDQoNCg0KICAgICAgICBrZXlzID0gKCkgPT4gew0KICAgICAgICAgICAgbGV0IGIgPSB7fTsNCg0KICAgICAgICAgICAgYltwLmJhY2tdID0gKCkgPT4gYmFjaygpOw0KDQogICAgICAgICAgICBpZiAoJCgnLnV0LW1hcmtldC1zZWFyY2gtZmlsdGVycy12aWV3JykubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guZGVjTWluQmlkXSA9ICgpID0+IG1vdXNlQ2xpY2soJCgnLmRlY3JlbWVudC12YWx1ZScpKTsNCiAgICAgICAgICAgICAgICBiW3Auc2VhcmNoLmluY01pbkJpZF0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5pbmNyZW1lbnQtdmFsdWUnKSk7DQogICAgICAgICAgICAgICAgYltwLnNlYXJjaC5kZWNNYXhCaWRdID0gKCkgPT4gbW91c2VDbGljaygkKCcuZGVjcmVtZW50LXZhbHVlOmVxKDEpJykpOw0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guaW5jTWF4QmlkXSA9ICgpID0+IG1vdXNlQ2xpY2soJCgnLmluY3JlbWVudC12YWx1ZTplcSgxKScpKTsNCiAgICAgICAgICAgICAgICBiW3Auc2VhcmNoLmRlY01pbkJ1eV0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5kZWNyZW1lbnQtdmFsdWU6ZXEoMiknKSk7DQogICAgICAgICAgICAgICAgYltwLnNlYXJjaC5pbmNNaW5CdXldID0gKCkgPT4gbW91c2VDbGljaygkKCcuaW5jcmVtZW50LXZhbHVlOmVxKDIpJykpOw0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guZGVjTWF4QnV5XSA9ICgpID0+IG1vdXNlQ2xpY2soJCgnLmRlY3JlbWVudC12YWx1ZTplcSgzKScpKTsNCiAgICAgICAgICAgICAgICBiW3Auc2VhcmNoLmluY01heEJ1eV0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5pbmNyZW1lbnQtdmFsdWU6ZXEoMyknKSk7DQogICAgICAgICAgICAgICAgYltwLnNlYXJjaC5zZWFyY2hdID0gKCkgPT4gc2VhcmNoKCk7DQogICAgICAgICAgICAgICAgYltwLnNlYXJjaC5yZXNldEJpZF0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5zZWFyY2gtcHJpY2UtaGVhZGVyID4gYnV0dG9uOmZpcnN0JykpOw0KICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guYm90TW9kZU1pbkJpZF0gPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmIChiLnNlYXJjaC5lbmFibGVCb3RNb2RlICYmIGJbcC5zZWFyY2guaW5jTWluQmlkXSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2goKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgYltwLnNlYXJjaC5ib3RNb2RlTWluQnV5XSA9ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGIuc2VhcmNoLmVuYWJsZUJvdE1vZGUgJiYgYltwLnNlYXJjaC5pbmNNaW5CdXldKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaCgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gJCgiLmxpc3RGVVRJdGVtIik7DQogICAgICAgICAgICAgICAgbGV0IGl0ZW1zRXhpc3RzID0gaXRlbXMubGVuZ3RoID4gMDsNCiAgICAgICAgICAgICAgICBsZXQgaXRlbXNDb250YWluZXIgPSBpdGVtcy5wYXJlbnRzKCcucGFnaW5hdGVkLCAudXQtd2F0Y2gtbGlzdC12aWV3LCAudXQtdHJhbnNmZXItbGlzdC12aWV3Jyk7DQogICAgICAgICAgICAgICAgaWYgKGl0ZW1zQ29udGFpbmVyLmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGl0ZW1zQ29udGFpbmVyID0gaXRlbXMucGFyZW50KCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGl0ZW1zRXhpc3RzICYmICQoJy5EZXRhaWxQYW5lbCA+IC5iaWRPcHRpb25zJykubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBiW3AucmVzdWx0cy5iaWRdID0gKCkgPT4gbW91c2VDbGljaygkKCcuYmlkQnV0dG9uJykpOw0KICAgICAgICAgICAgICAgICAgICBiW3AucmVzdWx0cy5idXldID0gKCkgPT4gYnV5Tm93KCk7DQogICAgICAgICAgICAgICAgICAgIGJbcC5yZXN1bHRzLmRlY0JpZF0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5iaWRPcHRpb25zIC5kZWNyZW1lbnQtdmFsdWUnKSk7DQogICAgICAgICAgICAgICAgICAgIGJbcC5yZXN1bHRzLmluY0JpZF0gPSAoKSA9PiBtb3VzZUNsaWNrKCQoJy5iaWRPcHRpb25zIC5pbmNyZW1lbnQtdmFsdWUnKSk7DQogICAgICAgICAgICAgICAgICAgIGJbcC5zZWFyY2guYm90TW9kZU1pbkJpZF0gPSAoKSA9PiBiLnNlYXJjaC5lbmFibGVCb3RNb2RlID8gYnV5Tm93KCkgOiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgYltwLnNlYXJjaC5ib3RNb2RlTWluQnV5XSA9ICgpID0+IGIuc2VhcmNoLmVuYWJsZUJvdE1vZGUgPyBidXlOb3coKSA6IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChpdGVtc0V4aXN0cyAmJiAkKCcuRGV0YWlsUGFuZWwgPiAudXQtYnV0dG9uLWdyb3VwJykubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBiW3AucmVzdWx0cy50cmFuc2Zlcl0gPSAoKSA9PiBtb3VzZUNsaWNrKHRyYW5zZmVyQnRuKCkpOw0KICAgICAgICAgICAgICAgICAgICBiW3AucmVzdWx0cy5jbHViXSA9ICgpID0+IG1vdXNlQ2xpY2soY2x1YkJ0bigpKTsNCiAgICAgICAgICAgICAgICAgICAgYltwLnJlc3VsdHMuc2VsbF0gPSAoKSA9PiBtb3VzZUNsaWNrKHNlbGxCdG4oKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGl0ZW1zRXhpc3RzKSB7DQogICAgICAgICAgICAgICAgICAgIGJbcC5saXN0cy51cF0gPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29udGFpbmVyID0gaXRlbXNDb250YWluZXI7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWQgPSAkKCcubGlzdEZVVEl0ZW0uc2VsZWN0ZWQnLCBjb250YWluZXIpLnByZXYoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9ICQoIi5saXN0RlVUSXRlbTpsYXN0LWNoaWxkIiwgY29udGFpbmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlQ2xpY2soc2VsZWN0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNzcygncG9zaXRpb24nLCAncmVsYXRpdmUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AoY29udGFpbmVyLnNjcm9sbFRvcCgpICsgc2VsZWN0ZWQucG9zaXRpb24oKS50b3AgLSBzZWxlY3RlZC5oZWlnaHQoKSk7DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIGJbcC5saXN0cy5kb3duXSA9ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb250YWluZXIgPSBpdGVtc0NvbnRhaW5lcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZCA9ICQoJy5saXN0RlVUSXRlbS5zZWxlY3RlZCcsIGNvbnRhaW5lcikubmV4dCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gJCgiLmxpc3RGVVRJdGVtOmZpcnN0LWNoaWxkIiwgY29udGFpbmVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlQ2xpY2soc2VsZWN0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNzcygncG9zaXRpb24nLCAncmVsYXRpdmUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AoY29udGFpbmVyLnNjcm9sbFRvcCgpICsgc2VsZWN0ZWQucG9zaXRpb24oKS50b3ApOw0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYltwLnNlYXJjaC5ib3RNb2RlTWluQmlkXSA9ICgpID0+IGIuc2VhcmNoLmVuYWJsZUJvdE1vZGUgPyBiYWNrKCkgOiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgYltwLnNlYXJjaC5ib3RNb2RlTWluQnV5XSA9ICgpID0+IGIuc2VhcmNoLmVuYWJsZUJvdE1vZGUgPyBiYWNrKCkgOiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoJCgnLnBhZ2luZ0NvbnRhaW5lcicpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgYltwLmxpc3RzLnByZXZdID0gKCkgPT4gbW91c2VDbGljaygkKCcucGFnaW5nQ29udGFpbmVyIC5wcmV2OnZpc2libGUnKSk7DQogICAgICAgICAgICAgICAgICAgIGJbcC5saXN0cy5uZXh0XSA9ICgpID0+IG1vdXNlQ2xpY2soJCgnLnBhZ2luZ0NvbnRhaW5lciAubmV4dDp2aXNpYmxlJykpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH07DQoNCiAgICAvLyBVSSB1cGRhdGUgYWZ0ZXIgYnV5IG5vdw0KICAgIGNvbnN0IHVwZGF0ZUJvdWdodFVJID0gKCkgPT4gew0KICAgICAgICBpZiAoIWVuYWJsZWQpIHJldHVybjsNCg0KICAgICAgICB2YXIgdHhCdG4gPSB0cmFuc2ZlckJ0bigpOw0KICAgICAgICBpZiAodHhCdG4ubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgIHNldFRpbWVvdXQodXBkYXRlQm91Z2h0VUksIDUwKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGxldCB1cGQgPSAodCwgdHgpID0+IHsNCiAgICAgICAgICAgIGlmICghdCkgcmV0dXJuOw0KICAgICAgICAgICAgbGV0IGFkZCA9IGAgWyAke3AucmVzdWx0c1t0eF19IF1gOw0KICAgICAgICAgICAgbGV0IGh0bWwgPSB0Lmh0bWwoKTsNCiAgICAgICAgICAgIGlmIChodG1sICYmIGh0bWwuaW5kZXhPZihhZGQpID09IC0xKSB7DQogICAgICAgICAgICAgICAgdC5odG1sKHQuaHRtbCgpICsgYWRkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHVwZCh0eEJ0biwgJ3RyYW5zZmVyJyk7DQogICAgICAgIHVwZChjbHViQnRuKCksICdjbHViJyk7DQogICAgICAgIHVwZChzZWxsQnRuKCksICdzZWxsJyk7DQogICAgfTsNCg0KICAgIGNvbnN0IGFkZENzcyA9ICgpID0+IHsNCiAgICAgICAgbGV0IGJ0biA9IChxLCBrMSwgazIsIGluYykgPT4gYCR7cX0gLiR7KGluYyA/ICdpbicgOiAnZGUnKX1jcmVtZW50LXZhbHVlOmFmdGVyIHsgZm9udC1zaXplOjEwcHg7IGRpc3BsYXk6YmxvY2s7IG1hcmdpbi10b3A6LTMwcHg7IGNvbnRlbnQ6ICdbICR7cFtrMV1bazJdfSBdJyB9YDsNCiAgICAgICAgbGV0IHNwMSA9IChpLCBrLCBpbmMpID0+IGJ0bihgLnNlYXJjaC1wcmljZXMgLnByaWNlLWZpbHRlcjpudGgtY2hpbGQoJHtpfSlgLCAnc2VhcmNoJywgaywgaW5jKTsNCiAgICAgICAgbGV0IHNwMiA9IChpLCBrMSwgazIpID0+IGAke3NwMShpLCBrMSl9JHtzcDEoaSwgazIsIHRydWUpfWA7DQogICAgICAgIGxldCBjc3MgPSBgDQogICAgICAgICAgICAke3NwMigyLCAnZGVjTWluQmlkJywgJ2luY01pbkJpZCcpfQ0KICAgICAgICAgICAgJHtzcDIoMywgJ2RlY01heEJpZCcsICdpbmNNYXhCaWQnKX0NCiAgICAgICAgICAgICR7c3AyKDUsICdkZWNNaW5CdXknLCAnaW5jTWluQnV5Jyl9DQogICAgICAgICAgICAke3NwMig2LCAnZGVjTWF4QnV5JywgJ2luY01heEJ1eScpfQ0KICAgICAgICAgICAgJHtidG4oJy5EZXRhaWxQYW5lbCA+IC5iaWRPcHRpb25zJywgJ3Jlc3VsdHMnLCAnZGVjQmlkJywgZmFsc2UpfQ0KICAgICAgICAgICAgJHtidG4oJy5EZXRhaWxQYW5lbCA+IC5iaWRPcHRpb25zJywgJ3Jlc3VsdHMnLCAnaW5jQmlkJywgdHJ1ZSl9DQogICAgICAgICAgICAudXQtbWFya2V0LXNlYXJjaC1maWx0ZXJzLXZpZXcgLmNhbGwtdG8tYWN0aW9uOmFmdGVyIHsgY29udGVudDogJ1sgJHtwLnNlYXJjaC5zZWFyY2h9XSd9DQogICAgICAgICAgICAudXQtbWFya2V0LXNlYXJjaC1maWx0ZXJzLXZpZXcgLnNlYXJjaC1wcmljZS1oZWFkZXI6Zmlyc3QtY2hpbGQgPiBidXR0b246YWZ0ZXIgeyBjb250ZW50OiAnWyAke3Auc2VhcmNoLnJlc2V0QmlkfV0nOyAgZm9udC1zaXplOiAxMHB4OyBkaXNwbGF5OiBibG9jayAgfQ0KICAgICAgICAgICAgLnV0LW5hdmlnYXRpb24tYnV0dG9uLWNvbnRyb2w6YWZ0ZXIgeyBmb250LXNpemU6MTBweDsgZmxvYXQ6cmlnaHQ7IG1hcmdpbi1yaWdodDoxMnB4OyBjb250ZW50OiAnWyAke3AuYmFja30gXScgfQ0KICAgICAgICAgICAgLnBhZ2luZ0NvbnRhaW5lciAucHJldjphZnRlciB7IGZvbnQtc2l6ZTogMTBweDsgZGlzcGxheTpibG9jazsgY29udGVudDogJ1sgJHtwLmxpc3RzLnByZXZ9IF0nIH0NCiAgICAgICAgICAgIC5wYWdpbmdDb250YWluZXIgLm5leHQ6YWZ0ZXIgeyBmb250LXNpemU6IDEwcHg7IGRpc3BsYXk6YmxvY2s7IGNvbnRlbnQ6ICdbICR7cC5saXN0cy5uZXh0fSBdJyB9DQogICAgICAgICAgICAuYmlkQnV0dG9uOmFmdGVyIHsgY29udGVudDogJyBbICR7cC5yZXN1bHRzLmJpZH0gXScgfQ0KICAgICAgICAgICAgLmJ1eUJ1dHRvbjpiZWZvcmUgeyBmbG9hdDpyaWdodDsgY29udGVudDogJyBbICR7cC5yZXN1bHRzLmJ1eX0gXScgfQ0KICAgICAgICAgICAgLnBsYXllci1kZWZpbml0aW9uLWlkIHsgcG9zaXRpb246IGFic29sdXRlOyBib3R0b206IDA7IH0NCiAgICAgICAgICAgIGA7DQoNCiAgICAgICAgYXBwU3R5bGVzLmlubmVyVGV4dCA9IGNzczsNCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gZW5hYmxlRGlzYWJsZUFwcCgpIHsNCiAgICAgICAgaWYgKGVuYWJsZWQpIHsNCiAgICAgICAgICAgIGRpc2FibGVBcHAoKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGVuYWJsZUFwcCgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZW5hYmxlQXBwKCkgew0KICAgICAgICBlbmFibGVkID0gdHJ1ZTsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhcHBTdHlsZXMpOw0KICAgICAgICBzZXJ2aWNlcy5Ob3RpZmljYXRpb24ucXVldWUoWyJQYWxlc25pcGUgRW5hYmxlZCIsIFVJTm90aWZpY2F0aW9uVHlwZS5QT1NJVElWRV0pDQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGlzYWJsZUFwcCgpIHsNCiAgICAgICAgZW5hYmxlZCA9IGZhbHNlOw0KICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGFwcFN0eWxlcyk7DQogICAgICAgIHNlcnZpY2VzLk5vdGlmaWNhdGlvbi5xdWV1ZShbIlBhbGVzbmlwZSBEaXNhYmxlZCIsIFVJTm90aWZpY2F0aW9uVHlwZS5ORVVUUkFMXSkNCiAgICB9DQoNCiAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHsNCiAgICAgICAgaWYgKGUuY29kZSA9PSBwLmVuYWJsZURpc2FibGUpIHsNCiAgICAgICAgICAgIGVuYWJsZURpc2FibGVBcHAoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghZW5hYmxlZCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IGFjdGlvbiA9IGtleXMoKVtlLmNvZGVdOw0KICAgICAgICBpZiAoYWN0aW9uKSBhY3Rpb24oKTsNCiAgICB9KTsNCg0KICAgIGFkZENzcygpOw0KICAgIGVuYWJsZUFwcCgpOw0KfSkoLypCVVRUT05TKi8pOw=="